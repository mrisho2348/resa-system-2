{% extends 'doctor_template/base_template.html' %}

{% block title %}
{{ patient.first_name }} {{ patient.middle_name }} {{ patient.last_name }}  Consultation notes
{% endblock title %}

{% block page_title %}
    <!-- Forward Button -->
     {% if consultation_note.doctor == request.user.staff %}
                {% if final_provisional_diagnosis %}
                <a class="btn btn-primary breadcrumb-link" type="button" 
                    href="
                    {% if consultation_note.doctor_plan == 'Prescription' %}
                        {% url 'doctor_save_prescription' patient.id visit.id %}
                    {% elif consultation_note.doctor_plan == 'Laboratory' %}
                        {% url 'doctor_save_remotesconsultation_notes_next' patient.id visit.id %}
                    {% elif consultation_note.doctor_plan == 'Referral' %}
                        {% url 'doctor_save_remotereferral' patient.id visit.id %}
                    {% elif consultation_note.doctor_plan == 'Counselling' %}
                        {% url 'doctor_save_remote_counseling' patient.id visit.id %}
                    {% elif consultation_note.doctor_plan == 'Procedure' %}
                        {% url 'doctor_save_remoteprocedure' patient.id visit.id %}
                    {% elif patient.remoteconsultationnotes_set.last.doctor_plan == 'Observation' %}
                        {% url 'doctor_save_observation' patient.id visit.id %}
                    {% elif consultation_note.doctor_plan == 'Discharge' %}
                        {% url 'doctor_save_remote_discharges_notes' patient.id visit.id %}
                    {% endif %}
                    ">
                    <i class="fas fa-arrow-left"></i> Back
                </a>       
            {% endif %}
     {% endif %}
    
      <a class="btn btn-primary breadcrumb-link" type="button"  href="{% url 'doctor_patient_visit_history_view' patient.id %}">
        <i class="fas fa-arrow-left"></i>visit history
    </a>  
         <a class="btn btn-primary breadcrumb-link" type="button"  href="{% url 'doctor_patient_health_record_view' patient.id visit.id %}">
        <i class="fas fa-arrow-left"></i>health record
    </a>  
    <!-- Back Button -->
     {% if consultation_note.doctor == request.user.staff %}
            {% if consultation_note %}
            <a class="btn btn-success breadcrumb-link" type="button" 
            href="
            {% if consultation_note.doctor_plan == 'Laboratory' %}
                {% url 'doctor_save_laboratory' patient.id visit.id %}
            {% else %}
                {% url 'doctor_save_remotesconsultation_notes_next' patient.id visit.id %}
            {% endif %}
            ">
            <i class="fas fa-arrow-right"></i> Forward
        </a>
            {% endif %}
     {% endif %}
    
{% endblock page_title %}

{% block breadcrumb %}
    {% include "doctor_template/modal_form.html" %}
Add  Consultation notes
     <!-- View All Visits Button -->
<button type="button" class="btn btn-outline-info btn-sm" data-toggle="modal" data-target="#patientVisitsModal">
    View result
</button>
{% endblock breadcrumb %}


{% block main_content %}

<!-- Modal: List of All Patient Visits -->
<div class="modal fade" id="patientVisitsModal" tabindex="-1" role="dialog" aria-labelledby="patientVisitsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      
      <!-- Modal Header -->
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title" id="patientVisitsModalLabel">
          Visit History for {{ patient.first_name }} {{ patient.last_name }}
        </h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <table class="table table-striped table-bordered table-sm">
          <thead class="thead-light">
            <tr>
              <th>Visit Number</th>
              <th>Visit Type</th>
              <th>Date</th>
              <th>Day</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for visit in patient_visits %}
              <tr>
                <td>{{ visit.vst }}</td>
                <td>{{ visit.get_visit_type_display }}</td>
                <td>{{ visit.created_at|date:"d-m-Y" }}</td>
                <td>{{ visit.created_at|date:"l" }}</td>
                <td>
                  <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#visitDetailModal_{{ visit.id }}">
                    View Details
                  </button>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="text-center">No previous visits found.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      
    </div>
  </div>
</div>


{% for visit in patient_visits %}
<div class="modal fade" id="visitDetailModal_{{ visit.id }}" tabindex="-1" role="dialog" aria-labelledby="visitDetailModalLabel_{{ visit.id }}" aria-hidden="true">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header bg-secondary text-white">
        <h5 class="modal-title" id="visitDetailModalLabel_{{ visit.id }}">Visit Details: {{ visit.vst }}</h5>
        <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">

      {% with consultation_note=visit.consultationnotes_set.first diagnosis_record=visit.patientdiagnosisrecord_set.first %}
          {% if consultation_note %}
            <div class="card clinical-notes-card mt-4">
              <div class="card-header bg-dark text-white">
                <h2 class="card-title">Clinical Notes</h2>
              </div>
              <div class="card-body">
                <table class="table table-bordered">
                  <tbody>

                    <tr>
                      <th>Chief Complaints:</th>
                      <td>
                        <ul>
                          {% for complaint in visit.clinicchiefcomplaint_set.all %}
                            <li>{{ complaint.health_record }} - Duration: {{ complaint.duration }}</li>
                          {% endfor %}
                        </ul>
                      </td>
                    </tr>

                    <tr>
                      <th>History of Presenting Illness:</th>
                      <td>{{ consultation_note.history_of_presenting_illness }}</td>
                    </tr>

                    <tr>
                      <th>Review of Systems:</th>
                      <td>{{ consultation_note.review_of_systems }}</td>
                    </tr>

                    <tr>
                      <th>Physical Examination:</th>
                      <td>{{ consultation_note.physical_examination }}</td>
                    </tr>

                    <tr>
                      <th>Doctor's Plan:</th>
                      <td>{{ consultation_note.doctor_plan }}</td>
                    </tr>

                    <tr>
                      <th>Doctor's Plan Notes:</th>
                      <td>{{ consultation_note.doctor_plan_note }}</td>
                    </tr>

                    <tr>
                      <th>Allergy Summary:</th>
                      <td>{{ consultation_note.allergy_summary }}</td>
                    </tr>

                    <tr>
                      <th>Known Comorbidities:</th>
                      <td>{{ consultation_note.known_comorbidities_summary }}</td>
                    </tr>

                    {% if diagnosis_record %}
                      <tr>
                        <th>Provisional Diagnosis:</th>
                        <td>
                          <ul class="list-group">
                            {% for pdx in diagnosis_record.provisional_diagnosis.all %}
                              <li class="list-group-item">{{ pdx.diagnosis_name }}</li>
                            {% endfor %}
                          </ul>
                        </td>
                      </tr>

                      <tr>
                        <th>Final Diagnosis:</th>
                        <td>
                          <ul class="list-group">
                            {% for fdx in diagnosis_record.final_diagnosis.all %}
                              <li class="list-group-item">{{ fdx.diagnosis_name }}</li>
                            {% endfor %}
                          </ul>
                        </td>
                      </tr>
                    {% endif %}

                  </tbody>
                </table>
              </div>
            </div>
          {% endif %}
        {% endwith %}

            {% if visit.patientvital_set.exists %}
                      <!-- 🔹 CARD: Vital Signs -->
              <div class="card mb-4">
                <div class="card-header bg-dark text-white">
                  <h6 class="mb-0">Vital Signs Records</h6>
                </div>
                <div class="card-body">
                  {% if visit.patientvital_set.exists %}
                    <div class="table-responsive">
                      <table class="table table-hover text-nowrap table-bordered table-striped table-sm">
                        <thead class="thead-dark">
                          <tr>
                            <th>#</th>
                            <th>Resp Rate</th>
                            <th>Pulse</th>
                            <th>BP</th>
                            <th>SBP</th>
                            <th>DBP</th>
                            <th>SPO2</th>
                            <th>Temp (°C)</th>
                            <th>GCS</th>
                            <th>AVPU</th>
                            <th>Weight</th>
                            <th>Recorded By</th>
                            <th>Recorded At</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for vitals in visit.patientvital_set.all %}
                          <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ vitals.respiratory_rate|default:"-" }}</td>
                            <td>{{ vitals.pulse_rate|default:"-" }}</td>
                            <td>{{ vitals.blood_pressure|default:"-" }}</td>
                            <td>{{ vitals.sbp|default:"-" }}</td>
                            <td>{{ vitals.dbp|default:"-" }}</td>
                            <td>{{ vitals.spo2|default:"-" }}%</td>
                            <td>{{ vitals.temperature|default:"-" }}</td>
                            <td>{{ vitals.gcs|default:"-" }}</td>
                            <td>{{ vitals.avpu|default:"-" }}</td>
                            <td>{{ vitals.weight|default:"-" }}</td>
                            <td>{{ vitals.recorded_by.get_full_name|default:"System" }}</td>
                            <td>{{ vitals.recorded_at|date:"d-m-Y" }}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  {% else %}
                    <p><em>No vitals recorded for this visit.</em></p>
                  {% endif %}
                </div>
              </div>
            {% endif %}

              {% if visit.imagingrecord_set.exists  %}
                         <!-- 🔹 CARD: Imaging Records -->
                <div class="card mb-4">
                  <div class="card-header bg-info text-white">
                    <h6 class="mb-0">Imaging Records</h6>
                  </div>
                  <div class="card-body">
                    {% if visit.imagingrecord_set.exists %}
                      <div class="table-responsive">
                        <table class="table table-bordered table-striped table-hover table-sm text-nowrap">
                          <thead class="thead-light">
                            <tr>
                              <th>#</th>
                              <th>Imaging</th>
                              <th>Description</th>
                              <th>Result</th>
                              <th>Image</th>
                              <th>Doctor</th>
                              <th>Ordered By</th>
                              <th>Order Date</th>
                              <th>Cost</th>
                              <th>Created At</th>
                              <th>Updated At</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for record in visit.imagingrecord_set.all %}
                            <tr>
                              <td>{{ forloop.counter }}</td>
                              <td>{{ record.imaging.name|default:"-" }}</td>
                              <td>{{ record.description|default:"-" }}</td>
                              <td>{{ record.result|default:"-" }}</td>
                              <td>
                                {% if record.image %}
                                  <a href="{{ record.image.url }}" target="_blank">View Image</a>
                                {% else %}
                                  <span class="text-muted">No Image</span>
                                {% endif %}
                              </td>
                              <td>{{ record.doctor.get_full_name|default:"-" }}</td>
                              <td>{{ record.data_recorder.get_full_name|default:"System" }}</td>
                              <td>{{ record.order_date|date:"d-m-Y" }}</td>
                              <td>{{ record.cost }}</td>
                              <td>{{ record.created_at|date:"d-m-Y" }}</td>
                              <td>{{ record.updated_at|date:"d-m-Y" }}</td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    {% else %}
                      <p><em>No imaging records available for this visit.</em></p>
                    {% endif %}
                  </div>
                </div>
              {% endif %}

                {% if visit.procedure_set.exists %}
                          <!-- 🔹 CARD: Procedures -->
                  <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                      <h6 class="mb-0">Procedure Records</h6>
                    </div>
                    <div class="card-body">
                      {% if visit.procedure_set.exists %}
                        <div class="table-responsive">
                          <table class="table table-bordered table-striped table-hover table-sm text-nowrap">
                            <thead class="thead-light">
                              <tr>
                                <th>#</th>
                                <th>Procedure No.</th>
                                <th>Procedure</th>
                                <th>Description</th>
                                <th>Doctor</th>
                                <th>Ordered By</th>
                                <th>Order Date</th>
                                <th>Equipments Used</th>
                                <th>Result</th>
                                <th>Cost</th>
                                <th>Created</th>
                                <th>Updated</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for procedure in visit.procedure_set.all %}
                              <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ procedure.procedure_number }}</td>
                                <td>{{ procedure.name.name|default:"-" }}</td>
                                <td>{{ procedure.description|default:"-" }}</td>
                                <td>{{ procedure.doctor.get_full_name|default:"-" }}</td>
                                <td>{{ procedure.data_recorder.get_full_name|default:"System" }}</td>
                                <td>{{ procedure.order_date|date:"d-m-Y" }}</td>
                                <td>{{ procedure.equipments_used }}</td>
                                <td>
                                  {% if procedure.result %}
                                    <div style="max-width: 300px; max-height: 150px; overflow:auto;">
                                      {{ procedure.result|safe }}
                                    </div>
                                  {% else %}
                                    <em>No result</em>
                                  {% endif %}
                                </td>
                                <td>{{ procedure.cost }}</td>
                                <td>{{ procedure.created_at|date:"d-m-Y" }}</td>
                                <td>{{ procedure.updated_at|date:"d-m-Y" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      {% else %}
                        <p><em>No procedures recorded for this visit.</em></p>
                      {% endif %}
                    </div>
                  </div>
                {% endif %}

                {% if visit.laboratoryorder_set.exists %}
                          <!-- 🔬 CARD: Laboratory Orders -->
                    <div class="card mb-4">
                      <div class="card-header bg-danger text-white">
                        <h6 class="mb-0">Laboratory Orders</h6>
                      </div>
                      <div class="card-body">
                        {% if visit.laboratoryorder_set.exists %}
                          <div class="table-responsive">
                            <table class="table table-bordered table-striped table-hover table-sm text-nowrap">
                              <thead class="thead-dark">
                                <tr>
                                  <th>#</th>
                                  <th>Lab No.</th>
                                  <th>Test</th>
                                  <th>Description</th>
                                  <th>Doctor</th>
                                  <th>Ordered By</th>
                                  <th>Order Date</th>
                                  <th>Result</th>
                                  <th>Cost</th>
                                  <th>Created</th>
                                  <th>Updated</th>
                                </tr>
                              </thead>
                              <tbody>
                                {% for lab in visit.laboratoryorder_set.all %}
                                <tr>
                                  <td>{{ forloop.counter }}</td>
                                  <td>{{ lab.lab_number }}</td>
                                  <td>{{ lab.name.name|default:"-" }}</td>
                                  <td>{{ lab.description|default:"-" }}</td>
                                  <td>{{ lab.doctor.get_full_name|default:"-" }}</td>
                                  <td>{{ lab.data_recorder.get_full_name|default:"System" }}</td>
                                  <td>{{ lab.order_date|date:"d-m-Y" }}</td>
                                  <td>
                                    {% if lab.result %}
                                      <div style="max-width: 300px; max-height: 150px; overflow:auto;">
                                        {{ lab.result|safe }}
                                      </div>
                                    {% else %}
                                      <em>No result</em>
                                    {% endif %}
                                  </td>
                                  <td>{{ lab.cost }}</td>
                                  <td>{{ lab.created_at|date:"d-m-Y" }}</td>
                                  <td>{{ lab.updated_at|date:"d-m-Y" }}</td>
                                </tr>
                                {% endfor %}
                              </tbody>
                            </table>
                          </div>
                        {% else %}
                          <p><em>No lab orders recorded for this visit.</em></p>
                        {% endif %}
                      </div>
                    </div>
                {% endif %}


                {% if visit.counseling_set.exists %}
                          <!-- 💬 CARD: Counseling Notes -->
                  <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                      <h6 class="mb-0">Counseling Notes</h6>
                    </div>
                    <div class="card-body">
                      {% if visit.counseling_set.exists %}
                        <div class="table-responsive">
                          <table class="table table-bordered table-striped table-hover table-sm text-nowrap">
                            <thead class="thead-light">
                              <tr>
                                <th>#</th>
                                <th>Recorder</th>
                                <th>Notes</th>
                                <th>Created</th>
                                <th>Updated</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for session in visit.counseling_set.all %}
                              <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ session.data_recorder.get_full_name|default:"System" }}</td>
                                <td>
                                  {% if session.counselling_notes %}
                                    <div style="max-width: 400px; max-height: 200px; overflow:auto;">
                                      {{ session.counselling_notes|safe }}
                                    </div>
                                  {% else %}
                                    <em>No notes recorded.</em>
                                  {% endif %}
                                </td>
                                <td>{{ session.created_at|date:"d-m-Y" }}</td>
                                <td>{{ session.updated_at|date:"d-m-Y" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      {% else %}
                        <p><em>No counseling notes for this visit.</em></p>
                      {% endif %}
                    </div>
                  </div>
                {% endif %}     

                {% if visit.prescription_set.exists %}
                            <!-- 💊 CARD: Prescription Records -->
                  <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                      <h6 class="mb-0">Prescription Records</h6>
                    </div>
                    <div class="card-body">
                      {% if visit.prescription_set.exists %}
                        <div class="table-responsive">
                          <table class="table table-bordered table-striped table-hover table-sm text-nowrap">
                            <thead class="thead-light">
                              <tr>
                                <th>#</th>
                                <th>Medicine</th>
                                <th>Dose</th>
                                <th>Frequency</th>
                                <th>Duration</th>
                                <th>Quantity Used</th>
                                <th>Total Price</th>
                                <th>Verified</th>
                                <th>Issued</th>
                                <th>Status</th>
                                <th>Entered By</th>
                                <th>Created At</th>
                                <th>Updated At</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for prescription in visit.prescription_set.all %}
                              <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ prescription.medicine.name }}</td>
                                <td>{{ prescription.dose }}</td>
                                <td>{{ prescription.frequency }}</td>
                                <td>{{ prescription.duration }}</td>
                                <td>{{ prescription.quantity_used }}</td>
                                <td>{{ prescription.total_price|default:"-" }}</td>
                                <td>{{ prescription.get_verified_display }}</td>
                                <td>{{ prescription.get_issued_display }}</td>
                                <td>{{ prescription.status }}</td>
                                <td>{{ prescription.entered_by.get_full_name|default:"System" }}</td>
                                <td>{{ prescription.created_at|date:"d-m-Y" }}</td>
                                <td>{{ prescription.updated_at|date:"d-m-Y" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      {% else %}
                        <p><em>No prescriptions recorded for this visit.</em></p>
                      {% endif %}
                    </div>
                  </div>
                {% endif %}

                {% if visit.observationrecord_set.exists %}
                          <!-- 📝 CARD: Observation Records -->
                  <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                      <h6 class="mb-0">Observation Records</h6>
                    </div>
                    <div class="card-body">
                      {% if visit.observationrecord_set.exists %}
                        <div class="table-responsive">
                          <table class="table table-bordered table-striped table-hover table-sm text-nowrap">
                            <thead class="thead-light">
                              <tr>
                                <th>#</th>
                                <th>Observation Notes</th>
                                <th>Recorded By</th>
                                <th>Created At</th>
                                <th>Updated At</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for observation in visit.observationrecord_set.all %}
                              <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ observation.observation_notes|safe }}</td>
                                <td>{{ observation.data_recorder.get_full_name|default:"System" }}</td>
                                <td>{{ observation.created_at|date:"d-m-Y" }}</td>
                                <td>{{ observation.updated_at|date:"d-m-Y" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      {% else %}
                        <p><em>No observations recorded for this visit.</em></p>
                      {% endif %}
                    </div>
                  </div>
                {% endif %} 

                {% if visit.dischargesnotes_set.exists %}
                          <!-- 🏥 CARD: Discharge Notes -->
                  <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                      <h6 class="mb-0">Discharge Notes</h6>
                    </div>
                    <div class="card-body">
                      {% if visit.dischargesnotes_set.exists %}
                        <div class="table-responsive">
                          <table class="table table-bordered table-striped table-hover table-sm text-nowrap">
                            <thead class="thead-light">
                              <tr>
                                <th>#</th>
                                <th>Discharge Condition</th>
                                <th>Discharge Notes</th>
                                <th>Recorded By</th>
                                <th>Discharge Date</th>
                                <th>Last Updated</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for discharge in visit.dischargesnotes_set.all %}
                              <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ discharge.discharge_condition|default:"-" }}</td>
                                <td>{{ discharge.discharge_notes|safe|default:"-" }}</td>
                                <td>{{ discharge.data_recorder.get_full_name|default:"System" }}</td>
                                <td>{{ discharge.discharge_date|date:"d-m-Y" }}</td>
                                <td>{{ discharge.updated_at|date:"d-m-Y" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      {% else %}
                        <p><em>No discharge notes recorded for this visit.</em></p>
                      {% endif %}
                    </div>
                  </div>

                {% endif %}

                {% if visit.referral_set.exists %}
                              <!-- 🏥 CARD: Referral Details -->
                    <div class="card mb-4">
                      <div class="card-header bg-info text-white">
                        <h6 class="mb-0">Referral Details</h6>
                      </div>
                      <div class="card-body">
                        {% if visit.referral_set.exists %}
                          <div class="table-responsive">
                            <table class="table table-bordered table-striped table-hover table-sm text-nowrap">
                              <thead class="thead-light">
                                <tr>
                                  <th>#</th>
                                  <th>Source Location</th>
                                  <th>Destination Location</th>
                                  <th>Nature of Referral</th>
                                  <th>Transport Model</th>
                                  <th>Notes</th>
                                  <th>Status</th>
                                  <th>Recorded By</th>
                                  <th>Created At</th>
                                  <th>Updated At</th>
                                </tr>
                              </thead>
                              <tbody>
                                {% for referral in visit.referral_set.all %}
                                <tr>
                                  <td>{{ forloop.counter }}</td>
                                  <td>{{ referral.source_location|default:"-" }}</td>
                                  <td>{{ referral.destination_location|default:"-" }}</td>
                                  <td>{{ referral.get_nature_of_referral_display|default:"-" }}</td>
                                  <td>{{ referral.get_transport_model_display|default:"-" }}</td>
                                  <td>{{ referral.notes|safe|default:"-" }}</td>
                                  <td>
                                    <span class="badge badge-{{ referral.get_status_color }}">
                                      {{ referral.get_status_display }}
                                    </span>
                                  </td>
                                  <td>{{ referral.data_recorder.get_full_name|default:"System" }}</td>
                                  <td>{{ referral.created_at|date:"d-m-Y" }}</td>
                                  <td>{{ referral.updated_at|date:"d-m-Y" }}</td>
                                </tr>
                                {% endfor %}
                              </tbody>
                            </table>
                          </div>
                        {% else %}
                          <p><em>No referrals recorded for this visit.</em></p>
                        {% endif %}
                      </div>
                    </div>
                {% endif %}
      </div>
    </div>
  </div>
</div>
{% endfor %}


    <div class="container-fluid">
           <!-- Patient Information Card -->
           <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header bg-primary-600">
                                    <h5 class="card-title text-center text-uppercase">Consultation</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row" style="font-size:13px;">
                                        <div class="col-md-3 text-uppercase">PATIENT: <b>{{ patient.first_name }} {{ patient.middle_name }}  {{ patient.last_name }}</b></div>
                                        <div class="col-md-3">DOB: <b>{{ patient.dob|date:'d-m-Y' }} [ Age: {% if patient.dob %}
                                            <script>
                                                var dob = new Date("{{ patient.dob|date:'Y-m-d' }}");
                                                var now = new Date();
                                                var ageMilliseconds = now - dob;
                                                var ageSeconds = ageMilliseconds / 1000;
                                                var ageYears = Math.floor(ageSeconds / (365.25 * 24 * 60 * 60));
                                                document.write(ageYears + ' years');
                                            </script>
                                            {% else %}
                                            {{ patient.age }}
                                            {% endif %}]</b></div>
                                        <div class="col-md-3 text-uppercase">SEX: <b>{{ patient.gender }}</b></div>
                                        <div class="col-md-3 text-uppercase">FILE NO : <b>{{ patient.mrn }}</b> </div>
                                    </div>
                                        <div class="row mt-3">
                                            <div class="col-md-3 text-uppercase">Visit number: <b>{{ visit.vst }}</b></div>
                                            <div class="col-md-3 text-uppercase">PAYMENT MODE: <b>{{ patient.payment_form }}</b></div>
                                        </div>
                                </div>  
                        </div> 
                    </div>
           </div>              
                        <br />
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <label for="chief_complaints">Vital signs</label>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-bordered">
                                                <thead>
                                                    <tr>                                          
                                                        <th>Time</th>
                                                        <th>BP</th>
                                                        <th>HR</th>
                                                        <th>RR</th>
                                                        <th>SPO2</th>                                         
                                                        <th>TEMP</th>
                                                        <th>GCS</th>
                                                        <th>Weight</th>
                                                        <th>AVPU</th>
                                                        <th></th>
                                                 </tr>
                                                </thead>
                                                <tbody>
                                                    {% for vital in patient_vitals %}
                                                        <tr>
                                                        <td>{{ vital.updated_at|time:"H:i:s" }}</td>
                                                        <td>{{ vital.blood_pressure }}</td>
                                                        <td>{{ vital.pulse_rate }}</td>
                                                        <td>{{ vital.respiratory_rate }}</td>
                                                        <td>{{ vital.spo2 }}</td>                                            
                                                        <td>{{ vital.temperature }}</td>
                                                        <td>{{ vital.gcs }}</td>
                                                        <td>{{ vital.weight }}</td>
                                                        <td>{{ vital.avpu }}</td>
                                                        <td>
                                                            <a href="#" class="btn btn-info btn-xs btn-labeled" type="button" data-toggle="modal" data-target="#editPatientVitalModal{{ vital.id }}"><b><i class="icon-pencil"></i></b> Edit</a>
                                                        </td>
                                                    </tr>
                                                    <div class="modal fade" id="editPatientVitalModal{{ vital.id }}" tabindex="-1" aria-labelledby="patientVitalModalLabel{{ vital.id }}" aria-hidden="true">
                                                        <div class="modal-dialog modal-lg">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="editPatientVitalModalLabel{{ vital.id }}">Edit Patient Vital</h5>
                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                        <span aria-hidden="true">&times;</span>
                                                                    </button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <div id="editVitalMessageContainer{{ vital.id }}" class="alert" role="alert"></div>
                                                                    <form id="editPatientVitalForm{{ vital.id }}" method="post">
                                                                        <!-- Patient ID (hidden input) -->
                                                                        <input type="hidden" name="patient_id" id="edit_patient_id" value="{{ patient.id }}">
                                                                        <input type="hidden" name="vital_id" id="edit_vital_id" value="{{ vital.id }}">
                                                                        <input type="hidden" class="form-control" id="visit_id" name="visit_id" value="{{ visit.id }}">
                                                    
                                                                        <!-- Row 1 -->
                                                                        <div class="row">
                                                                            <!-- Column 1 -->
                                                                            <div class="col-md-6">
                                                                                <div class="mb-3 form-group">
                                                                                    <label for="edit_respiratoryRate{{ vital.id }}" class="form-label">Respiratory Rate (bpm)</label>
                                                                                    <select class="form-control select2bs4" style="width: 100%;" id="edit_respiratoryRate{{ vital.id }}" name="respiratory_rate">
                                                                                        {% for rate in range_51 %}
                                                                                            <option value="{{ rate }}" {% if rate == vital.respiratory_rate %} selected {% endif %}>{{ rate }}</option>
                                                                                        {% endfor %}
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                            <!-- Column 2 -->
                                                                            <div class="col-md-6">
                                                                                <div class="mb-3 form-group">
                                                                                    <label for="edit_pulseRate{{ vital.id }}" class="form-label">Pulse Rate (bpm)</label>
                                                                                    <select class="form-control select2bs4" style="width: 100%;" id="edit_pulseRate{{ vital.id }}" name="pulse_rate">
                                                                                        {% for rate in range_301 %}
                                                                                            <option value="{{ rate }}" {% if rate == vital.pulse_rate %} selected {% endif %}>{{ rate }}</option>
                                                                                        {% endfor %}
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                    
                                                                        <!-- Row 2 -->
                                                                        <div class="row">
                                                                            <!-- Column 1 -->
                                                                            <div class="col-md-6">
                                                                                <div class="mb-3 form-group">
                                                                                    <label for="edit_sbp{{ vital.id }}">Systolic Blood Pressure (mmHg)</label>
                                                                                    <select class="form-control select2bs4" style="width: 100%;" id="edit_sbp{{ vital.id }}" name="sbp" required>
                                                                                        <option value=""></option>
                                                                                        {% for sbp in range_301 %}
                                                                                            <option value="{{ sbp }}" {% if sbp == vital.sbp %} selected {% endif %}>{{ sbp }}</option>
                                                                                        {% endfor %}
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                            <!-- Column 2 -->
                                                                            <div class="col-md-6">
                                                                                <div class="mb-3 form-group">
                                                                                    <label for="edit_dbp{{ vital.id }}">Diastolic Blood Pressure (mmHg)</label>
                                                                                    <select class="form-control select2bs4" style="width: 100%;" id="edit_dbp{{ vital.id }}" name="dbp" required>
                                                                                        <option value=""></option>
                                                                                        {% for dbp in range_301 %}
                                                                                            <option value="{{ dbp }}" {% if dbp == vital.dbp %} selected {% endif %}>{{ dbp }}</option>
                                                                                        {% endfor %}
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                    
                                                                        <!-- Row 3 -->
                                                                        <div class="row">
                                                                            <!-- Column 1 -->
                                                                            <div class="col-md-6">
                                                                                <div class="mb-3 form-group">
                                                                                    <label for="edit_spo2{{ vital.id }}" class="form-label">SPO2 (%)</label>
                                                                                    <select class="form-control select2bs4" style="width: 100%;" id="edit_spo2{{ vital.id }}" name="spo2" required>
                                                                                        {% for percentage in range_101 %}
                                                                                            <option value="{{ percentage }}" {% if percentage == vital.spo2 %} selected {% endif %}>{{ percentage }}%</option>
                                                                                        {% endfor %}
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                            <!-- Column 2 -->
                                                                            <div class="col-md-6">
                                                                                <div class="mb-3 form-group">
                                                                                    <label for="edit_temperature{{ vital.id }}" class="form-label">Temperature (°C)</label>
                                                                                    <select class="form-control select2bs4" style="width: 100%;" id="edit_temperature{{ vital.id }}" name="temperature" required>
                                                                                        {% for temp in temps %}
                                                                                            <option value="{{ temp }}" {% if temp == vital.temperature %} selected {% endif %}>{{ temp }}</option>
                                                                                        {% endfor %}
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                    
                                                                        <!-- Row 4 -->
                                                                        <div class="row">
                                                                            <!-- Column 1 -->
                                                                            <div class="col-md-6">
                                                                                <div class="mb-3 form-group">
                                                                                    <label for="edit_gcs{{ vital.id }}" class="form-label">Glasgow Coma Scale</label>
                                                                                    <select class="form-control select2bs4" style="width: 100%;" id="edit_gcs{{ vital.id }}" name="gcs" required>
                                                                                        {% for score in range_15 %}
                                                                                            <option value="{{ score }}" {% if score == vital.gcs %} selected {% endif %}>{{ score }}</option>
                                                                                        {% endfor %}
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                            <!-- Column 2 -->
                                                                            <div class="col-md-6">
                                                                                <div class="mb-3 form-group">
                                                                                    <label for="edit_avpu{{ vital.id }}" class="form-label">AVPU Scale</label>
                                                                                    <select class="form-control select2bs4" style="width: 100%;" id="edit_avpu{{ vital.id }}" name="avpu" required>
                                                                                        <option value="Alert" {% if vital.avpu == 'Alert' %} selected {% endif %}>Alert</option>
                                                                                        <option value="Verbal" {% if vital.avpu == 'Verbal' %} selected {% endif %}>Verbal</option>
                                                                                        <option value="Pain" {% if vital.avpu == 'Pain' %} selected {% endif %}>Pain</option>
                                                                                        <option value="Unresponsive" {% if vital.avpu == 'Unresponsive' %} selected {% endif %}>Unresponsive</option>
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!-- Row 5 -->
                                                                        <div class="row">
                                                                            <!-- Column 1 -->
                                                                            <div class="col-md-6">
                                                                                <div class="mb-3 form-group">
                                                                                    <label for="weight{{ vital.id }}" class="form-label">Weight</label>
                                                                                    <select class="form-control select2bs4" style="width: 100%;" id="weight{{ vital.id }}" name="weight" required>
                                                                                        {% for weight in range_301 %}
                                                                                            <option value="{{ weight }}" {% if weight == vital.weight %} selected {% endif %}>{{ weight }}</option>
                                                                                        {% endfor %}
                                                                                    </select>
                                                                                </div>
                                                                            </div>                                                                            
                                                                        </div>
                                                    
                                                                        <!-- Submit Button -->
                                                                        <div class="form-row">
                                                                            <div class="col-md-12">
                                                                                <button type="button" class="btn btn-primary btn-block" onclick="updateRemotePatientVital({{ vital.id }})">Update Patient Vital</button>
                                                                            </div>
                                                                        </div>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>                                                   
                                                 {% endfor %}
                                                 <script>
                                                    // Handle form submission using AJAX
                                                    function updateRemotePatientVital(vitalId) {
                                                        $.ajax({
                                                            type: 'POST',
                                                            url: '{% url "doctor_save_remotepatient_vital" %}',  // Replace with your URL
                                                            data: $('#editPatientVitalForm' + vitalId).serialize(),
                                                            success: function (response) {
                                                                // If the request is successful, display a success message
                                                                if (response.status) {
                                                                    $('#editVitalMessageContainer' + vitalId).html('<div class="alert alert-success">' + response.message + '</div>');
                                                                        location.reload(true)
                                                                } else {
                                                                    $('#editVitalMessageContainer' + vitalId).html('<div class="alert alert-danger">' + response.message + '</div>');
                                                                }
                                                            },
                                                            error: function (xhr, error) {
                                                                // If the request fails, display an error message
                                                                $('#editVitalMessageContainer' + vitalId).html('<div class="alert alert-danger">Error: ' + xhr.responseText + '</div>');
                                                            }
                                                        });
                                                    }
                                                </script>                                      
                                                 
                                                </tbody>
                                            </table>
                                            <div class="row">
                                                <div class="col-md-10"></div>
                                                <div class="col-md-2"><a href="#" class="btn btn-info btn-xs btn-labeled" type="button" data-toggle="modal" data-target="#addPatientVitalModal"><b><i class="fa fa-plus-square"></i></b> Add New vital</a></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                         <label for="chief_complaints">Chief Complaints</label>
                                    </div>
                                  <div class="card-body">
                                <div id="savedChiefComplaints">
                                   <div id="popupContainer" class="popup-container"></div>
                                        <!-- Chief Complaints List -->
                                        <div id="chiefComplaintsList" class="mt-3">
                                            <table class="table table-borderless">                                       
                                                <tbody id="chiefComplaintsDisplayBody">
                                                    <!-- Existing saved complaints inserted here -->
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- Full Edit Table (Initially hidden) -->
                                        <div id="chiefComplaintsEditTableContainer" class="mt-3 d-none">
                                            <table class="table table-bordered" id="chiefComplaintsTable">
                                                <thead>
                                                    <tr>
                                                        <th>Chief Complaint</th>
                                                        <th>Duration</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Populated dynamically -->
                                                </tbody>
                                            </table>
                                        </div>

                                        <!-- Add/Edit Complaint Row (Initially hidden) -->
                                        <div id="chiefComplaintFormRow" class="mt-3 d-none">
                                            <table class="table table-borderless">
                                                <tbody id="chiefComplaintInputRowBody">
                                                    <!-- Row gets injected here dynamically -->
                                                </tbody>
                                            </table>
                                        </div>

                                        <!-- Action Buttons -->
                                        <div class="mt-2">
                                            <button type="button" id="addChiefComplaintButton" class="btn btn-sm btn-info">
                                                <i class="fa fa-plus-square"></i> Add Chief Complaint
                                            </button>
                                            <button type="button" id="toggleEditChiefComplaints" class="btn btn-sm btn-warning">
                                                <i class="fa fa-edit"></i> Edit
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                       
                        
                        <script>
                            $(document).ready(function () {
                                const patientId = $('#patient_id').val();
                                const visitId = $('#visit_id').val();
                              $('#chiefComplaintsList').show();
                                // Function to initialize Select2 dynamically
                                function initializeSelect2(selector) {
                                    $(selector).select2({
                                        theme: 'bootstrap4',
                                        width: '100%',
                                    });
                                }
                        
                             let editingMode = false;
                                let rowCounter = 0;

                                $('#toggleEditChiefComplaints').on('click', function () {
                                    editingMode = !editingMode;

                                    if (editingMode) {
                                        $('#chiefComplaintsList').hide();
                                        $('#chiefComplaintFormRow').addClass('d-none'); // hide input row
                                        $('#addChiefComplaintButton').addClass('d-none'); // hide add button
                                        $('#chiefComplaintsEditTableContainer').removeClass('d-none'); // show editable table
                                        $(this).html('<i class="fa fa-eye"></i> View');
                                    } else {
                                        $('#chiefComplaintFormRow').addClass('d-none');
                                        $('#chiefComplaintsList').show();                                
                                        $('#addChiefComplaintButton').removeClass('d-none');
                                        $('#chiefComplaintsEditTableContainer').addClass('d-none');
                                        $(this).html('<i class="fa fa-edit"></i> Edit');
                                    }
                                });



                                $('#addChiefComplaintButton').on('click', function () {
                                    $('#chiefComplaintFormRow').removeClass('d-none');

                                    const rowId = `chiefComplaintRow${rowCounter}`;
                                    const inputRow = `
                                        <tr id="${rowId}" class="temporary-row">
                                            <td>
                                               <label>Chief Complaint</label>
                                                <select class="form-control select2bs4" name="chief_complain_name" required>
                                                    {% for health_record in health_records %}
                                                        <option value="{{ health_record.id }}">{{ health_record.name }}</option>
                                                    {% endfor %}
                                                    <option value="other">Other</option>
                                                </select>
                                            </td>
                                            <td>
                                               <label>Duration</label>
                                                <input type="text" class="form-control" name="chief_complain_duration" placeholder="Duration (days)" required>
                                            </td>
                                            <td>
                                                <label>Actions</label><br>
                                                <button type="button" class="btn btn-danger btn-sm delete-row">Delete</button>
                                                <button type="button" class="btn btn-success btn-sm save-row">Save</button>
                                            </td>
                                        </tr>`;

                                    $('#chiefComplaintInputRowBody').append(inputRow);

                                    initializeSelect2(`#${rowId} .select2bs4`);
                                    bindEventListener(rowId);

                                    rowCounter++; // Increase after appending
                                });

                               function bindEventListener(rowId) {
                                const row = $(`#${rowId}`);

                                // Save button
                                row.find('.save-row').on('click', function () {
                                    saveChiefComplaint(rowId);
                                });

                                // Delete button
                                row.find('.delete-row').on('click', function () {
                                    $(`#${rowId}`).remove();
                                });

                                // Handle "Other" selection in dropdown
                                row.find('select[name="chief_complain_name"]').on('change', function () {
                                    const selectedValue = $(this).val();
                                    handleOtherOption(selectedValue, rowId);
                                });
                            }

                        
                                 
                                function handleOtherOption(value, rowId) {
                                const row = $(`#${rowId}`);
                                
                                // Check if the "Other" input already exists
                                const existingOtherInput = row.find('input[name="other_complaint"]').closest('td');

                                if (value === 'other') {
                                    if (existingOtherInput.length === 0) {
                                        // Add "Other" input after the select field (1st td)
                                        row.find('td:first').after(`
                                            <td>
                                                <label>Other Complaint</label>
                                                <input type="text" class="form-control" name="other_complaint" placeholder="Enter Other Chief Complaint" required>
                                            </td>`);
                                    }
                                } else {
                                    existingOtherInput.remove();
                                }
                            }

                            

                            // Fetch and display existing chief complaints (table and list)
                            function fetchAndDisplayChiefComplaints() {
                                const url = `{% url 'doctor_endpoint_to_fetch_existing_data' %}`;

                                const requestData = {
                                    patient_id: patientId,
                                    visit_id: visitId
                                };

                                $.getJSON(url, requestData)
                                    .done(function (data) {
                                        // Populate both table view and list view
                                        populateChiefComplaintsTable(data);
                                        populateChiefComplaintsList(data);
                                    })
                                    .fail(function () {
                                        // Show error message on failure
                                        displayPopupMessage('Error fetching chief complaints.', 'alert-danger');
                                    });
                            }

                        
                                // Populate the table with chief complaints     
                                function populateChiefComplaintsTable(data) {
                                    const container = $('#chiefComplaintsTable tbody');

                                    container.empty(); // Clear the table before populating
                             
                                    if (!Array.isArray(data) || data.length === 0) {
                                        container.append('<tr><td colspan="3" class="text-center">No Chief Complaints Found</td></tr>');
                                        return;
                                    }
                                
                                    data.forEach(item => {
                                        const row = `
                                                <tr id="chiefComplaintRow${item.id}" data-id="${item.id}">
                                                    <td>
                                                        <span class="display-text">${item.health_record || item.other_complaint || 'N/A'}</span>
                                                    </td>
                                                    <td>
                                                        <span class="display-text">${item.duration || 'N/A'}</span>
                                                        <input type="text" class="form-control editable-field d-none" name="chief_complain_duration" value="${item.duration || ''}" placeholder="Duration (days)">
                                                    </td>
                                                    <td>
                                                        {% if item.data_recorder_id == item.staff_id %}
                                                        <button type="button" class="btn btn-danger btn-sm delete-chief-complaint" data-id="${item.id}">Delete</button>
                                                        <button type="button" class="btn btn-primary btn-sm edit-chief-complaint" data-row-id="chiefComplaintRow${item.id}" data-id="${item.id}">Edit</button>
                                                        <button type="button" class="btn btn-success btn-sm save-changes d-none" data-id="${item.id}" data-row-id="chiefComplaintRow${item.id}">Save Changes</button>
                                                        <button type="button" class="btn btn-secondary btn-sm cancel-edit d-none" data-id="${item.id}" data-row-id="chiefComplaintRow${item.id}">Cancel</button>
                                                        {% endif %}
                                                    </td>
                                                </tr>`;
                                        container.append(row);
                                       
                                    });
                                
                                    data.forEach(item => {
                                        bindEventListeners(item.id);
                                    });
                                }
                                

                               function populateChiefComplaintsList(data) {
                                const container = $('#chiefComplaintsList');
                                container.empty(); // Clear previous content

                                if (!Array.isArray(data) || data.length === 0) {
                                    container.append('<p class="text-muted text-center">No Chief Complaints Found</p>');
                                    return;
                                }

                                const list = $('<div class="list-group list-group-flush"></div>');

                                data.forEach(item => {
                                    const complaint = item.health_record || item.other_complaint || 'N/A';
                                    const duration = item.duration ? `${item.duration}` : 'N/A';

                                    const listItem = $(`
                                        <div class="list-group-item py-2 px-3">
                                            <strong>${complaint}</strong> &ndash; <span class="text-muted">${duration}</span>
                                        </div>
                                    `);

                                    list.append(listItem);
                                });

                                container.append(list);
                            }



                               function bindEventListeners(rowId) {
                                    const row = $(`#chiefComplaintRow${rowId}`);

                                    row.find('.edit-chief-complaint').on('click', function () {
                                        // Hide the display version and show only the duration input
                                        row.find('[name="chief_complain_duration"]').removeClass('d-none');
                                        row.find('[name="chief_complain_duration"]').prev('.display-text').addClass('d-none');

                                        row.find('.edit-chief-complaint, .delete-chief-complaint').addClass('d-none');
                                        row.find('.save-changes, .cancel-edit').removeClass('d-none');
                                    });

                                    row.find('.cancel-edit').on('click', function () {
                                        // Hide input and show display again
                                        row.find('[name="chief_complain_duration"]').addClass('d-none');
                                        row.find('[name="chief_complain_duration"]').prev('.display-text').removeClass('d-none');

                                        row.find('.edit-chief-complaint, .delete-chief-complaint').removeClass('d-none');
                                        row.find('.save-changes, .cancel-edit').addClass('d-none');
                                    });

                                    row.find('.save-changes').on('click', function () {
                                        const id = $(this).data('id');
                                        const rowId = $(this).data('row-id');
                                        saveChangeChiefComplaint(rowId, id);
                                    });

                                    row.find('.delete-chief-complaint').on('click', function () {
                                        const id = $(this).data('id');
                                        deleteChiefComplaint(id);
                                    });
                                }

                                
                             // Function to retrieve CSRF token from cookies
                                    function getCSRFToken() {
                                        var csrfToken = null;
                                        document.cookie.split(';').forEach(function(cookie) {
                                            if (cookie.trim().startsWith('csrftoken=')) {
                                                csrfToken = cookie.trim().substring('csrftoken='.length);
                                            }
                                        });
                                        return csrfToken;
                                    }
                                    

                                    function saveChangeChiefComplaint(rowId, id) {
                                        const row = $(`#${rowId}`);

                                        if (row.length === 0) {
                                            displayPopupMessage(`Row with ID "${rowId}" not found.`, 'alert-warning');
                                            return;
                                        }

                                        const durationField = row.find('[name="chief_complain_duration"]');
                                        const chief_complain_duration = durationField.val();

                                        if (!chief_complain_duration) {
                                            displayPopupMessage('Please provide a valid duration.', 'alert-warning');
                                            return;
                                        }

                                        const formData = {
                                            chief_complain_duration: chief_complain_duration,
                                        };

                                        const url = "{% url 'doctor_update_chief_complaint' chief_complaint_id=0 %}".replace('0', id);

                                        $.ajax({
                                            url: url,
                                            method: 'POST',
                                            data: JSON.stringify(formData),
                                            contentType: 'application/json',
                                            headers: {
                                                'X-CSRFToken': getCSRFToken(),
                                            },
                                            success: function (response) {
                                                if (response.status) {
                                                    displayPopupMessage(response.message, 'alert-success');
                                                    fetchAndDisplayChiefComplaints();
                                                } else {
                                                    displayPopupMessage(response.message, 'alert-danger');
                                                }
                                            },
                                            error: function () {
                                                displayPopupMessage('Error saving changes.', 'alert-danger');
                                            },
                                        });
                                    }


                        
                                // Delete a chief complaint
                                function deleteChiefComplaint(id) {
                                    const url = `{% url 'doctor_delete_chief_complaint' chief_complaint_id=0 %}`.replace('0', id);
                                
                                    $.ajax({
                                        url: url,
                                        type: 'POST', // Use POST to support _method simulation
                                        data: { _method: 'DELETE' }, // Simulate DELETE request
                                        headers: {
                                            'X-CSRFToken': '{{ csrf_token }}', // Include CSRF token
                                        },
                                        success: function () {
                                            fetchAndDisplayChiefComplaints(); // Refresh the list on success
                                        },
                                        error: function (xhr) {
                                            const response = JSON.parse(xhr.responseText); // Parse JSON error response
                                            const errorMessage = response.error || 'Unknown error occurred';
                                            displayPopupMessage(`Error: ${errorMessage}`, 'alert-danger');
                                        },
                                    });
                                }
                          
                                // Save a chief complaint
                                function saveChiefComplaint(rowId) {
                                    const row = $(`#${rowId}`);
                                    const formData = {
                                        patient_id: patientId,
                                        visit_id: visitId,
                                        chief_complain_name: row.find('[name="chief_complain_name"]').val(),
                                        chief_complain_duration: row.find('[name="chief_complain_duration"]').val(),
                                        other_complaint: row.find('[name="other_complaint"]').val() || null,
                                    };
                        
                                    if (!formData.chief_complain_name || !formData.chief_complain_duration) {
                                        displayPopupMessage('Please complete all required fields.', 'alert-danger');
                                        return;
                                    }
                        
                                    console.log('Submitting data:', formData); // Debugging
                        
                                    const url = "{% url 'doctor_save_chief_complaint' %}";
                        
                                    $.post(url, formData, function (response) {
                                        console.log('Response received:', response); // Debugging
                        
                                        if (response.status) {
                                            row.remove(); // Remove the saved row from the form
                                            fetchAndDisplayChiefComplaints(); // Refresh the table to display the saved data
                                        } else {
                                            displayPopupMessage(response.message || 'Failed to save chief complaint.', 'alert-danger');
                                        }
                                    }).fail(function (xhr, status, error) {
                                        console.error('Error saving chief complaint:', status, error); // Debugging
                                        displayPopupMessage('Error saving chief complaint.', 'alert-danger');
                                    });
                                }

                       
                                // Display popup messages
                                function displayPopupMessage(message, alertType) {
                                    const popup = `<div class="alert ${alertType}">${message}</div>`;
                                    $('#popupContainer').html(popup);

                                    // Set timer to remove the popup after 5 seconds (5000ms)
                                    setTimeout(function() {
                                        $('#popupContainer').html(''); // Clears the popup
                                    }, 5000);
                                }

                        
                                // Delete a row in the form
                                function deleteChiefComplaintRow(rowId) {
                                    $(`#${rowId}`).remove();
                                }
                        
                                // Event bindings
                                $('#addChiefComplaintButton').click(function () {
                                    addChiefComplaintRow(); // Only add a new row
                                });                    
                                fetchAndDisplayChiefComplaints();
                            });

                          
                           
                        </script>
                        
                     
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">Add Consultation Notes</div>
                    <div class="card-body">
                        <form id="addConsultationForm" action="{% url 'doctor_save_remotesconsultation_notes' patient.id visit.id %}" method="post">
                            {% csrf_token %}
                            <div class="container-fluid">
                               <!-- Known Comorbidities -->
                              <div class="row mt-3">
                                <div class="col-md-12">
                                  <div class="card">
                                    <div class="card-header">
                                      <h6 class="text-center text-uppercase">Known Comorbidities</h6>
                                    </div>
                                    <div class="card-body">

                                      <!-- Comorbidity Toggle -->
                                      <div class="form-group">
                                        <label>Does the patient have any known comorbidities?</label>
                                        <select class="form-control" id="comorbidityToggle">
                                          <option value="">-- Select --</option>
                                          <option value="yes">Yes</option>
                                          <option value="no">No</option>
                                        </select>
                                      </div>

                                      <!-- Comorbidity Selection Section -->
                                      <div id="comorbiditySection" style="display: none;">
                                        <label>Select Comorbidities and Medication Status:</label>
                                        <div class="row">
                                          <!-- Hypertension -->
                                          <div class="col-md-3">
                                            <label>
                                              <input type="checkbox" class="comorbidity-checkbox" data-condition="Hypertension"> Hypertension
                                            </label>
                                            <select class="form-control mt-1 comorbidity-status" data-condition="Hypertension" disabled>
                                              <option value="">-- Select Status --</option>
                                              <option value="regularly">regularly</option>
                                              <option value="irregularly">irregularly</option>
                                              <option value="not on">not on</option>
                                            </select>
                                          </div>

                                          <!-- Diabetes -->
                                          <div class="col-md-3">
                                            <label>
                                              <input type="checkbox" class="comorbidity-checkbox" data-condition="Diabetes"> Diabetes
                                            </label>
                                            <select class="form-control mt-1 comorbidity-status" data-condition="Diabetes" disabled>
                                              <option value="">-- Select Status --</option>
                                              <option value="regularly">regularly</option>
                                              <option value="irregularly">irregularly</option>
                                              <option value="not on">not on</option>
                                            </select>
                                          </div>

                                          <!-- IMC -->
                                          <div class="col-md-3">
                                            <label>
                                              <input type="checkbox" class="comorbidity-checkbox" data-condition="IMC"> IMC
                                            </label>
                                            <select class="form-control mt-1 comorbidity-status" data-condition="IMC" disabled>
                                              <option value="">-- Select Status --</option>
                                              <option value="regularly">regularly</option>
                                              <option value="irregularly">irregularly</option>
                                              <option value="not on">not on</option>
                                            </select>
                                          </div>

                                          <!-- Asthma -->
                                          <div class="col-md-3">
                                            <label>
                                              <input type="checkbox" class="comorbidity-checkbox" data-condition="Asthma"> Asthma
                                            </label>
                                            <select class="form-control mt-1 comorbidity-status" data-condition="Asthma" disabled>
                                              <option value="">-- Select Status --</option>
                                              <option value="regularly">regularly</option>
                                              <option value="irregularly">irregularly</option>
                                              <option value="not on">not on</option>
                                            </select>
                                          </div>
                                        </div>
                                      </div>

                                      <!-- No Comorbidities Section -->
                                      <div class="form-check mt-3" id="noComorbiditySection" style="display: none;">
                                        <input class="form-check-input" type="checkbox" id="noComorbidities">
                                        <label class="form-check-label" for="noComorbidities">Patient has no pre-existing comorbidities</label>
                                      </div>

                                      <!-- Summary Display -->
                                      <div class="form-group mt-3">
                                        <label>Comorbidity Summary:</label>
                                        <textarea class="form-control" id="comorbiditySummaryDisplay" rows="3" readonly>{{ consultation_note.known_comorbidities_summary }}</textarea>
                                        <input type="hidden" id="known_comorbidities_summary" name="known_comorbidities_summary" value="{{ consultation_note.known_comorbidities_summary }}">
                                      </div>

                                    </div>
                                  </div>
                                </div>
                              </div>


                                                        <script>
                                document.addEventListener("DOMContentLoaded", function () {
                                  const summaryField = document.getElementById('known_comorbidities_summary');
                                  const displayField = document.getElementById('comorbiditySummaryDisplay');

                                  const comorbidityToggle = document.getElementById('comorbidityToggle');
                                  const comorbiditySection = document.getElementById('comorbiditySection');
                                  const noComorbiditySection = document.getElementById('noComorbiditySection');
                                  const noComorbiditiesCheckbox = document.getElementById('noComorbidities');

                                  // Create "Others" checkbox and input field
                                  const othersContainer = document.createElement('div');
                                  othersContainer.classList.add('col-md-3');
                                  othersContainer.innerHTML = `
                                    <label>
                                      <input type="checkbox" class="comorbidity-checkbox" data-condition="Others" id="chkOthers"> Others
                                    </label>
                                    <input type="text" class="form-control mt-1 d-none" id="txtOthers" placeholder="Specify other comorbidities">
                                  `;
                                  // Append to the comorbiditySection
                                  const row = comorbiditySection.querySelector('.row');
                                  row.appendChild(othersContainer);

                                  const othersCheckbox = document.getElementById('chkOthers');
                                  const othersInput = document.getElementById('txtOthers');

                                  comorbidityToggle.addEventListener('change', function () {
                                    const value = this.value;

                                    if (value === 'yes') {
                                      comorbiditySection.style.display = 'block';
                                      noComorbiditySection.style.display = 'none';
                                      noComorbiditiesCheckbox.checked = false;
                                      noComorbiditiesCheckbox.dispatchEvent(new Event('change')); // clear any effects
                                    } else if (value === 'no') {
                                      comorbiditySection.style.display = 'none';
                                      noComorbiditySection.style.display = 'block';
                                      noComorbiditiesCheckbox.checked = true;
                                      noComorbiditiesCheckbox.dispatchEvent(new Event('change'));
                                    } else {
                                      comorbiditySection.style.display = 'none';
                                      noComorbiditySection.style.display = 'none';
                                    }
                                  });

                                  function updateComorbiditySummary() {
                                    let summary = '';
                                    const phrases = [];

                                    document.querySelectorAll('.comorbidity-checkbox').forEach(cb => {
                                      const condition = cb.dataset.condition;
                                      const select = document.querySelector(`.comorbidity-status[data-condition="${condition}"]`);

                                      if (cb.checked && select && select.value) {
                                        phrases.push(`${condition.toLowerCase()} on ${select.value} medication`);
                                      }
                                    });

                                    // Handle "Others" input
                                    if (othersCheckbox.checked) {
                                      const otherText = othersInput.value.trim();
                                      if (otherText) {
                                        phrases.push(`other comorbidities: ${otherText}`);
                                      }
                                    }

                                    if (noComorbiditiesCheckbox.checked) {
                                      summary = "Patient has no pre-existing comorbidities.";
                                    } else if (phrases.length > 0) {
                                      const joined = phrases.length === 1
                                        ? phrases[0]
                                        : phrases.slice(0, -1).join(', ') + ' and ' + phrases.slice(-1);
                                      summary = `This is a known patient with ${joined}.`;
                                    } else {
                                      summary = '';
                                    }

                                    summaryField.value = summary;
                                    displayField.value = summary;
                                  }

                                  document.querySelectorAll('.comorbidity-checkbox').forEach(cb => {
                                    cb.addEventListener('change', function () {
                                      const condition = this.dataset.condition;
                                      const statusSelect = document.querySelector(`.comorbidity-status[data-condition="${condition}"]`);
                                      if (statusSelect) statusSelect.disabled = !this.checked;
                                      updateComorbiditySummary();
                                    });
                                  });

                                  document.querySelectorAll('.comorbidity-status').forEach(select => {
                                    select.addEventListener('change', updateComorbiditySummary);
                                  });

                                  noComorbiditiesCheckbox.addEventListener('change', function () {
                                    const isChecked = this.checked;

                                    document.querySelectorAll('.comorbidity-checkbox').forEach(cb => {
                                      cb.checked = false;
                                      cb.disabled = isChecked;
                                      const select = document.querySelector(`.comorbidity-status[data-condition="${cb.dataset.condition}"]`);
                                      if (select) {
                                        select.disabled = true;
                                        select.value = '';
                                      }
                                    });

                                    othersInput.classList.add('d-none');
                                    othersInput.value = '';
                                    updateComorbiditySummary();
                                  });

                                  othersCheckbox.addEventListener('change', function () {
                                    if (this.checked) {
                                      othersInput.classList.remove('d-none');
                                    } else {
                                      othersInput.classList.add('d-none');
                                      othersInput.value = '';
                                    }
                                    updateComorbiditySummary();
                                  });

                                  othersInput.addEventListener('input', updateComorbiditySummary);
                                });
                              </script>

                                                    <div class="row mt-3">
                                <div class="col-md-12">
                                  <div class="card mt-4">
                                    <div class="card-header">
                                      <strong>Allergy Information</strong>
                                    </div>
                                    <div class="card-body">
                                      <div class="form-group">
                                        <label>Does the patient have any allergies?</label><br>
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="radio" name="has_allergy" id="hasAllergyYes" value="yes">
                                          <label class="form-check-label" for="hasAllergyYes">Yes</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="radio" name="has_allergy" id="hasAllergyNo" value="no">
                                          <label class="form-check-label" for="hasAllergyNo">No</label>
                                        </div>
                                      </div>

                                    <div id="allergyDetails" class="mt-3" style="display: none;">
                                      <!-- Food Allergy -->
                                      <div class="form-check mb-2">
                                        <input class="form-check-input allergy-checkbox" type="checkbox" id="chkFoodAllergy">
                                        <label class="form-check-label" for="chkFoodAllergy">Food Allergy</label>
                                      </div>
                                      <div class="form-group d-none" id="foodAllergyGroup">
                                        <input type="text" class="form-control" id="foodAllergy" placeholder="E.g. Fish">
                                      </div>

                                      <!-- Medicine Allergy -->
                                      <div class="form-check mb-2">
                                        <input class="form-check-input allergy-checkbox" type="checkbox" id="chkMedicineAllergy">
                                        <label class="form-check-label" for="chkMedicineAllergy">Medicine Allergy</label>
                                      </div>
                                      <div class="form-group d-none" id="medicineAllergyGroup">
                                        <input type="text" class="form-control" id="medicineAllergy" placeholder="E.g. Penicillin">
                                      </div>

                                      <!-- Other Allergy -->
                                      <div class="form-check mb-2">
                                        <input class="form-check-input allergy-checkbox" type="checkbox" id="chkOtherAllergy">
                                        <label class="form-check-label" for="chkOtherAllergy">Other Allergy</label>
                                      </div>
                                      <div class="form-group d-none" id="otherAllergyGroup">
                                        <input type="text" class="form-control" id="otherAllergy" placeholder="E.g. Dust">
                                      </div>
                                    </div>


                                      <div class="form-group mt-3">
                                        <label>Allergy Summary:</label>
                                        <textarea class="form-control" id="allergySummaryDisplay" rows="3" readonly></textarea>
                                        <input type="hidden" name="allergy_summary" id="allergySummary">
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <script>
                                const hasAllergyYes = document.getElementById("hasAllergyYes");
                                const hasAllergyNo = document.getElementById("hasAllergyNo");
                                const allergyDetails = document.getElementById("allergyDetails");
                                const foodAllergy = document.getElementById("foodAllergy");
                                const medicineAllergy = document.getElementById("medicineAllergy");
                                const otherAllergy = document.getElementById("otherAllergy");
                                const allergySummaryDisplay = document.getElementById("allergySummaryDisplay");
                                const allergySummary = document.getElementById("allergySummary");

                                const chkFoodAllergy = document.getElementById("chkFoodAllergy");
                                const chkMedicineAllergy = document.getElementById("chkMedicineAllergy");
                                const chkOtherAllergy = document.getElementById("chkOtherAllergy");

                                const foodAllergyGroup = document.getElementById("foodAllergyGroup");
                                const medicineAllergyGroup = document.getElementById("medicineAllergyGroup");
                                const otherAllergyGroup = document.getElementById("otherAllergyGroup");

                                const initialSummary = `{{ consultation_note.allergy_summary|default:"" }}`.trim();

                                function generateAllergySummary() {
                                  let summary = '';

                                  if (hasAllergyNo.checked) {
                                    summary = "Patient has no known allergies.";
                                  } else {
                                    let parts = [];

                                    if (chkFoodAllergy.checked && foodAllergy.value.trim()) {
                                      parts.push(`food: ${foodAllergy.value.trim()}`);
                                    }
                                    if (chkMedicineAllergy.checked && medicineAllergy.value.trim()) {
                                      parts.push(`medicine: ${medicineAllergy.value.trim()}`);
                                    }
                                    if (chkOtherAllergy.checked && otherAllergy.value.trim()) {
                                      parts.push(`other: ${otherAllergy.value.trim()}`);
                                    }

                                    if (parts.length > 0) {
                                      summary = `This patient has allergy to ${parts.join(", ")}.`;
                                    } else {
                                      summary = "This patient reports allergies, but no specific substances were provided.";
                                    }
                                  }

                                  allergySummaryDisplay.value = summary;
                                  allergySummary.value = summary;
                                }

                                function toggleInputField(checkbox, groupDiv) {
                                  groupDiv.classList.toggle("d-none", !checkbox.checked);
                                  if (!checkbox.checked) {
                                    groupDiv.querySelector("input").value = '';
                                  }
                                  generateAllergySummary();
                                }

                                chkFoodAllergy.addEventListener("change", () => toggleInputField(chkFoodAllergy, foodAllergyGroup));
                                chkMedicineAllergy.addEventListener("change", () => toggleInputField(chkMedicineAllergy, medicineAllergyGroup));
                                chkOtherAllergy.addEventListener("change", () => toggleInputField(chkOtherAllergy, otherAllergyGroup));

                                hasAllergyYes.addEventListener("change", () => {
                                  allergyDetails.style.display = "block";
                                  generateAllergySummary();
                                });

                                hasAllergyNo.addEventListener("change", () => {
                                  allergyDetails.style.display = "none";
                                  [chkFoodAllergy, chkMedicineAllergy, chkOtherAllergy].forEach(chk => chk.checked = false);
                                  [foodAllergyGroup, medicineAllergyGroup, otherAllergyGroup].forEach(group => {
                                    group.classList.add("d-none");
                                    group.querySelector("input").value = '';
                                  });
                                  generateAllergySummary();
                                });

                                [foodAllergy, medicineAllergy, otherAllergy].forEach(input => {
                                  input.addEventListener("input", generateAllergySummary);
                                });

                                function prepopulateAllergyFields() {
                                  if (!initialSummary) {
                                    hasAllergyNo.checked = true;
                                    allergyDetails.style.display = "none";
                                    generateAllergySummary();
                                    return;
                                  }

                                  allergySummaryDisplay.value = initialSummary;
                                  allergySummary.value = initialSummary;

                                  if (initialSummary.toLowerCase().includes("no known allergies")) {
                                    hasAllergyNo.checked = true;
                                    allergyDetails.style.display = "none";
                                  } else {
                                    hasAllergyYes.checked = true;
                                    allergyDetails.style.display = "block";

                                    const foodMatch = initialSummary.match(/food:\s*([^,]+)/i);
                                    const medicineMatch = initialSummary.match(/medicine:\s*([^,]+)/i);
                                    const otherMatch = initialSummary.match(/other:\s*([^,]+)/i);

                                    if (foodMatch) {
                                      chkFoodAllergy.checked = true;
                                      foodAllergyGroup.classList.remove("d-none");
                                      foodAllergy.value = foodMatch[1].trim();
                                    }

                                    if (medicineMatch) {
                                      chkMedicineAllergy.checked = true;
                                      medicineAllergyGroup.classList.remove("d-none");
                                      medicineAllergy.value = medicineMatch[1].trim();
                                    }

                                    if (otherMatch) {
                                      chkOtherAllergy.checked = true;
                                      otherAllergyGroup.classList.remove("d-none");
                                      otherAllergy.value = otherMatch[1].trim();
                                    }
                                  }

                                  generateAllergySummary();
                                }

                                window.addEventListener("DOMContentLoaded", prepopulateAllergyFields);
                              </script>

                               <!-- Consultation Text Areas -->
                              <div class="row">                               
                               <div class="col-md-6">
                                  <div class="form-group">
                                    <label for="hpi">History of Presenting Illness (HPI):</label>
                                    <textarea class="form-control" id="hpi" name="history_of_presenting_illness" rows="10">{{ consultation_note.history_of_presenting_illness }}</textarea>

                                    <!-- Tabs Navigation -->
                                    <ul class="nav nav-tabs mt-3" id="hpiTab" role="tablist">
                                      <li class="nav-item">
                                        <a class="nav-link active" id="general-tab" data-toggle="tab" href="#general" role="tab">General</a>
                                      </li>
                                      <li class="nav-item">
                                        <a class="nav-link" id="resp-tab" data-toggle="tab" href="#resp" role="tab">Respiratory</a>
                                      </li>
                                      <li class="nav-item">
                                        <a class="nav-link" id="abd-tab" data-toggle="tab" href="#abd" role="tab">Abdomen & GI</a>
                                      </li>
                                      <li class="nav-item">
                                        <a class="nav-link" id="uro-tab" data-toggle="tab" href="#uro" role="tab">Urogenital</a>
                                      </li>
                                      <li class="nav-item">
                                        <a class="nav-link" id="msk-tab" data-toggle="tab" href="#msk" role="tab">Musculoskeletal</a>
                                      </li>
                                      <li class="nav-item">
                                        <a class="nav-link" id="derma-tab" data-toggle="tab" href="#derma" role="tab">Dermatology</a>
                                      </li>
                                    </ul>

                                    <!-- Tabs Content -->
                                    <div class="tab-content border border-top-0 p-3" id="hpiTabContent">
                                      <!-- General -->
                                      <div class="tab-pane fade show active" id="general" role="tabpanel">
                                        <button type="button" class="btn btn-sm btn-outline-danger ml-2 mb-2" data-toggle="modal" data-target="#feverModal">Fever</button>
                                        <button type="button"  class="btn btn-sm btn-outline-warning ml-2 mb-2" data-toggle="modal" data-target="#headacheModal">Headache</button>
                                        <button type="button"  class="btn btn-sm btn-outline-success ml-2 mb-2" data-toggle="modal" data-target="#gbmModal">Generalized Malaise</button>
                                      </div>

                                      <!-- Respiratory -->
                                      <div class="tab-pane fade" id="resp" role="tabpanel">
                                        <button type="button"  class="btn btn-sm btn-outline-info ml-2 mb-2" data-toggle="modal" data-target="#fluModal">Flu</button>
                                        <button type="button"  class="btn btn-sm btn-outline-warning ml-2 mb-2" data-toggle="modal" data-target="#coughModal">Cough</button>
                                        <button type="button"  class="btn btn-sm btn-outline-danger ml-2 mb-2" data-toggle="modal" data-target="#dibModal">Difficulty in Breathing</button>
                                        <button type="button"  class="btn btn-sm btn-outline-warning ml-2 mb-2" data-toggle="modal" data-target="#chestPainModal">Chest Pain</button>
                                      </div>

                                      <!-- Abdomen & GI -->
                                      <div class="tab-pane fade" id="abd" role="tabpanel">
                                        <button type="button"  class="btn btn-sm btn-outline-success ml-2 mb-2" data-toggle="modal" data-target="#gaseousDiscomfortModal">Gaseous Discomfort</button>
                                        <button type="button"  class="btn btn-sm btn-outline-primary ml-2 mb-2" data-toggle="modal" data-target="#abdominalPainModal">Abdominal Pain</button>
                                        <button type="button"  class="btn btn-sm btn-outline-primary ml-2 mb-2" data-toggle="modal" data-target="#lowerAbdPainModal">Lower Abdominal Pain</button>
                                        <button type="button"  class="btn btn-sm btn-outline-primary ml-2 mb-2" data-toggle="modal" data-target="#constipationModal">Constipation</button>
                                      </div>

                                      <!-- Urogenital -->
                                      <div class="tab-pane fade" id="uro" role="tabpanel">
                                        <button type="button"  class="btn btn-sm btn-outline-primary ml-2 mb-2" data-toggle="modal" data-target="#pvDischargeModal">PV Discharge</button>
                                        <button type="button"  class="btn btn-sm btn-outline-danger ml-2 mb-2" data-toggle="modal" data-target="#painfulMicturitionModal">Painful Micturition</button>
                                      </div>

                                      <!-- Musculoskeletal -->
                                      <div class="tab-pane fade" id="msk" role="tabpanel">
                                        <button type="button"  class="btn btn-sm btn-outline-warning ml-2 mb-2" data-toggle="modal" data-target="#backPainModal">Back Pain</button>
                                        <button type="button"   class="btn btn-sm btn-outline-info ml-2 mb-2" data-toggle="modal" data-target="#jointPainModal">Joint Pain</button>
                                      </div>

                                      <!-- Dermatology -->
                                      <div class="tab-pane fade" id="derma" role="tabpanel">
                                        <button type="button"   class="btn btn-sm btn-outline-danger ml-2 mb-2" data-toggle="modal" data-target="#rashesModal">Rashes</button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                                                    <!-- ROS -->
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="ros">Review of Other Systems (ROS):</label>
                                            <textarea class="form-control" id="ros" name="review_of_systems" rows="10">{{ consultation_note.review_of_systems }}</textarea>
                                            <button type="button" class="btn btn-sm btn-outline-primary mt-2" data-toggle="modal" data-target="#rosModal">Edit in Modal</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Physical Examination -->
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="text-center text-uppercase">Physical Examination</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-group">
                                                    <label for="physical_examination">Physical Examination Notes:</label>
                                                    <textarea class="form-control" id="physical_examination" name="physical_examination" rows="10">{{ consultation_note.physical_examination }}</textarea>
                                                    <button type="button" class="btn btn-sm btn-outline-primary mt-2" data-toggle="modal" data-target="#physicalExamModal">Edit in Modal</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Provisional Diagnosis -->
                                <div class="form-group mt-4">
                                    <label for="provisional_diagnosis_{{ consultation_note.id }}">Provisional Diagnosis:</label>
                                    <select class="form-control select2bs4" id="provisional_diagnosis_{{ consultation_note.id }}" name="provisional_diagnosis[]" multiple required>
                                        {% for diagnosis in provisional_diagnoses %}
                                            <option value="{{ diagnosis.id }}" {% if diagnosis.id in provisional_diagnosis_ids %}selected{% endif %}>{{ diagnosis }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                 <div class="form-group mt-4">                                        
                                            <label for="doctor_plan_note">Doctor Plan note:</label>
                                            <textarea class="form-control" id="doctor_plan_note" name="doctor_plan_note" rows="2">{{ consultation_note.doctor_plan_note }}</textarea>                                           
                                  </div>
                                <!-- Doctor's Plan -->
                                <div class="form-group mt-3">
                                    <label for="doctor_plan">Doctor Plan:</label>
                                        <select class="form-control select2bs4" style="width: 100%;" id="doctor_plan" name="doctor_plan" required>
                                            <option value="">Select Doctor Plan</option>
                                            <option value="Prescription" {% if consultation_note.doctor_plan == 'Prescription' %} selected {% endif %}>Prescription</option>
                                            <option value="Laboratory" {% if consultation_note.doctor_plan == 'Laboratory' %} selected {% endif %}>Laboratory</option>                                          
                                            <option value="Procedure" {% if consultation_note.doctor_plan == 'Procedure' %} selected {% endif %}>Procedure</option>
                                            <option value="Observation" {% if consultation_note.doctor_plan == 'Observation' %} selected {% endif %}>Observation</option>
                                            <option value="Referral" {% if consultation_note.doctor_plan == 'Referral' %} selected {% endif %}>Referral</option>
                                            <option value="Counselling" {% if consultation_note.doctor_plan == 'Counselling' %} selected {% endif %}>Counselling</option>
                                            <option value="Discharge" {% if consultation_note.doctor_plan == 'Discharge' %} selected {% endif %}>Discharge</option>
                                            <option value="Radiology" {% if consultation_note.doctor_plan == 'Radiology' %} selected {% endif %}>Radiology</option>
                                        </select>
                                </div>

                                <!-- Submit Button -->
                                <div class="form-row mt-4">
                                    <div class="col-md-12">
                                        <button type="submit" class="btn btn-primary btn-block">Save & Continue</button>
                                    </div>
                                </div>
                                <div class="card-footer">
                                        {% if messages %}
                                        <div class="row">
                                            <div class="col-12">
                                                {% for message in messages %}
                                                {% if message.tags == 'error' %}
                                                <div class="alert alert-danger alert-message">{{ message }}</div>
                                                {% elif message.tags == 'success' %}
                                                <div class="alert alert-primary alert-message">{{ message }}</div>
                                                {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
    // Fade out alerts after 5 seconds (5000ms)
    setTimeout(function() {
        document.querySelectorAll('.alert-message').forEach(function(el) {
            el.style.transition = 'opacity 0.5s ease-out';
            el.style.opacity = '0';
            setTimeout(() => el.style.display = 'none', 500);
        });
    }, 5000);
</script>


<div class="modal fade" id="abdominalPainModal" tabindex="-1" role="dialog" aria-labelledby="abdominalPainModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow-lg rounded">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="abdominalPainModalLabel">Abdominal Pain Details</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="abdominalPainForm">
          <div class="container-fluid">
            <div class="row g-3">
              <!-- Duration -->
              <div class="col-md-6">
                <label for="abdPainDuration" class="form-label">Duration (days):</label>
                <input type="number" class="form-control" id="abdPainDuration" placeholder="e.g. 4">
              </div>

              <!-- Pain Type -->
              <div class="col-md-6">
                <label for="painType" class="form-label">Pain Type:</label>
                <select class="form-control select2bs4" id="painType"  style="width: 100%;">
                  <option>dull</option>
                  <option>sharp</option>
                  <option>burning</option>
                </select>
              </div>

              <!-- Pain Timing -->
              <div class="col-md-6">
                <label for="painTiming" class="form-label">Pain Timing:</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="painTiming">
                  <option value="none">No specific periodicity</option>
                  <option value="during">More during meals</option>
                  <option value="after">More after meals</option>
                  <option value="empty">More when on empty stomach</option>
                </select>
              </div>

              <!-- Pain Relief -->
              <div class="col-md-6">
                <label for="painRelief" class="form-label">Pain Relief:</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="painRelief">
                  <option value="food">Relieved by food</option>
                  <option value="empty">Relieved on empty stomach</option>
                  <option value="both">Relieved by both food and empty stomach</option>
                  <option value="none">Not relieved</option>
                </select>
              </div>

              <!-- Diarrhoea Type -->
              <div class="col-md-6">
                <label for="diarrhoeaType" class="form-label">Diarrhoea Type:</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="diarrhoeaType">
                  <option value="none">No diarrhoea</option>
                  <option value="mucoid">Mucoid</option>
                  <option value="watery">Watery</option>
                </select>
              </div>

              <!-- Diarrhoea Blood -->
              <div class="col-md-6">
                <label for="diarrhoeaBlood" class="form-label">Diarrhoea Associated with Blood?</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="diarrhoeaBlood">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </div>

              <!-- Constipation Associated -->
              <div class="col-md-6">
                <label for="constipationAssociated" class="form-label">Associated with Constipation?</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="constipationAssociated">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>
            </div>

            <!-- Submit button -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-success px-5" onclick="generateAbdPain()">Add to HPI</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
function generateAbdPain() {
  const days = document.getElementById("abdPainDuration").value;
  const painType = document.getElementById("painType").value;
  const painTiming = document.getElementById("painTiming").value;
  const painRelief = document.getElementById("painRelief").value;
  const diarrhoeaType = document.getElementById("diarrhoeaType").value;
  const diarrhoeaBlood = document.getElementById("diarrhoeaBlood").value;
  const constipation = document.getElementById("constipationAssociated").value;

  let timingText = "";
  if (painTiming === "none") timingText = "has no specific periodicity";
  else if (painTiming === "during") timingText = "is more during meals";
  else if (painTiming === "after") timingText = "is more after meals";
  else if (painTiming === "empty") timingText = "is more when on empty stomach";

  let reliefText = "";
  if (painRelief === "food") reliefText = "The pain is relieved by intake of food.";
  else if (painRelief === "empty") reliefText = "The pain is relieved when on an empty stomach.";
  else if (painRelief === "both") reliefText = "The pain is relieved by both food intake and when on empty stomach.";
  else reliefText = "The pain is not relieved by either food or posture.";

  let diarrhoeaText = "";
  if (diarrhoeaType === "none") {
    diarrhoeaText = "There is no history of diarrhoea.";
  } else {
    const bloodText = diarrhoeaBlood === "yes" ? "and is associated with blood" : "and is not associated with blood";
    diarrhoeaText = `There is also history of diarrhoea that is nonspecific in periodicity and is ${diarrhoeaType} in nature ${bloodText}.`;
  }

  const constipationText = constipation === "yes"
    ? "The abdominal pain is associated with constipation."
    : "The abdominal pain is not associated with constipation.";

  const sentence = `The patient has had abdominal pain that has been there for ${days} days, and this has been more generalised and non-radiating. The pain is described as ${painType} in nature and ${timingText}. ${reliefText} ${diarrhoeaText} ${constipationText}`;

  appendToHPI(sentence);
  $('#abdominalPainModal').modal('hide');
}

function appendToHPI(text) {
  const hpiField = document.getElementById("hpi");
  hpiField.value += (hpiField.value ? "\n" : "") + text;
}
</script>

<div class="modal fade" id="lowerAbdPainModal" tabindex="-1" role="dialog" aria-labelledby="lowerAbdPainModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow-lg rounded">
      <div class="modal-header bg-secondary text-white">
        <h5 class="modal-title" id="lowerAbdPainModalLabel">Lower Abdominal Pain Details</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="lowerAbdPainForm">
          <div class="container-fluid">
            <div class="row g-3">
              <!-- Duration -->
              <div class="col-md-6">
                <label for="lowerAbdDuration" class="form-label">Duration (days):</label>
                <input type="number" class="form-control" id="lowerAbdDuration" placeholder="e.g. 3">
              </div>

              <!-- Discharge -->
              <div class="col-md-6">
                <label for="dischargePresence" class="form-label">Discharge Present?</label>
                <select  class="form-control select2bs4"  style="width: 100%;"  id="dischargePresence">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>

              <!-- Foul Smell -->
              <div class="col-md-6">
                <label for="foulSmell" class="form-label">Foul Smell Present?</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="foulSmell">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>

              <!-- Pessary -->
              <div class="col-md-6">
                <label for="pessaryUsed" class="form-label">Vaginal Pessary Used?</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="pessaryUsed">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>

              <!-- Cream -->
              <div class="col-md-6">
                <label for="creamUsed" class="form-label">Vaginal Cream Used?</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="creamUsed">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>

              <!-- Improvement -->
              <div class="col-md-6">
                <label for="improvement" class="form-label">Improvement Observed?</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="improvement">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>
            </div>

            <!-- Submit button -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-success px-5" onclick="generateLowerAbdPain()">Add to HPI</button>
              </div>
            </div>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>


<script>
  function generateLowerAbdPain() {
  const days = document.getElementById("lowerAbdDuration").value;
  const discharge = document.getElementById("dischargePresence").value;
  const smell = document.getElementById("foulSmell").value;
  const pessary = document.getElementById("pessaryUsed").value;
  const cream = document.getElementById("creamUsed").value;
  const improvement = document.getElementById("improvement").value;

  let dischargeText = discharge === "yes"
    ? "She has also been experiencing discharge"
    : "She has not been experiencing discharge";

  let smellText = smell === "yes"
    ? "this has resulted in foul smell"
    : "there is no foul smell";

  let pessaryText = pessary === "yes"
    ? "She has used vaginal pessary"
    : "She has not used vaginal pessary";

  let creamText = cream === "yes"
    ? "and has also used vaginal cream"
    : "and has not used vaginal cream";

  let improvementText = improvement === "yes"
    ? "that has resulted in improvement."
    : "that has not resulted in improvement.";

  const sentence = `She has been experiencing lower abdominal pain that has been there for the past ${days} days, and this has resulted in pain at all times when moving and when not moving. ${dischargeText} and ${smellText}. ${pessaryText} ${creamText} ${improvementText}`;

  appendToHPI(sentence);
  $('#lowerAbdPainModal').modal('hide');
}

function appendToHPI(text) {
  const hpiField = document.getElementById("hpi");
  hpiField.value += (hpiField.value ? "\n" : "") + text;
}

</script>

<div class="modal fade" id="constipationModal" tabindex="-1" role="dialog" aria-labelledby="constipationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-md" role="document">
    <div class="modal-content shadow rounded">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title" id="constipationModalLabel">Constipation Details</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="constipationForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Duration -->
              <div class="col-md-12">
                <label for="constipationDuration" class="form-label">Duration (days):</label>
                <input type="number" class="form-control" id="constipationDuration" placeholder="e.g. 2">
              </div>

              <!-- Stool Consistency -->
              <div class="col-md-12">
                <label for="constipationStool" class="form-label">Stool Consistency:</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="constipationStool">
                  <option value="very hard">Very Hard</option>
                  <option value="hard">Hard</option>
                  <option value="lumpy">Lumpy</option>
                </select>
              </div>

              <!-- History of Abdominal Pain -->
              <div class="col-md-12">
                <label for="constipationAbdominalPain" class="form-label">History of Abdominal Pain?</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="constipationAbdominalPain">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </div>

            </div>

            <!-- Submit Button -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-success px-4" onclick="generateConstipation()">Add to HPI</button>
              </div>
            </div>

          </div>
        </form>
      </div>

    </div>
  </div>
</div>

<script>
  function generateConstipation() {
  const days = document.getElementById("constipationDuration").value;
  const stool = document.getElementById("constipationStool").value;
  const pain = document.getElementById("constipationAbdominalPain").value;

  let painText = pain === "yes" 
    ? "There is a history of abdominal pain." 
    : "There is no history of abdominal pain.";

  const sentence = `Patient has had constipation that has been there for the past ${days} days, and this is associated with ${stool} stool. ${painText}`;

  appendToHPI(sentence);
  $('#constipationModal').modal('hide');
}

function appendToHPI(text) {
  const hpiField = document.getElementById("hpi");
  hpiField.value += (hpiField.value ? "\n" : "") + text;
}

</script>
<div class="modal fade" id="pvDischargeModal" tabindex="-1" role="dialog" aria-labelledby="pvDischargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow-lg rounded">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="pvDischargeModalLabel">PV Discharge Details</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="pvDischargeForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Duration -->
              <div class="col-md-6">
                <label for="pvDuration" class="form-label">Duration (days):</label>
                <input type="number" class="form-control" id="pvDuration" placeholder="e.g. 5">
              </div>

              <!-- Nature of Discharge -->
              <div class="col-md-6">
                <label for="pvNature" class="form-label">Nature of Discharge:</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="pvNature">
                  <option>Whitish</option>
                  <option>Yellowish</option>
                  <option>Greenish</option>
                </select>
              </div>

              <!-- Itching Duration -->
              <div class="col-md-6">
                <label for="pvItchingDuration" class="form-label">Itching Duration (days):</label>
                <input type="number" class="form-control" id="pvItchingDuration" placeholder="e.g. 2">
              </div>

              <!-- Associated with LAP -->
              <div class="col-md-6">
                <label for="pvLap" class="form-label">Associated with LAP:</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="pvLap">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>

              <!-- Medication Used -->
              <div class="col-md-6">
                <label for="pvMedUsed" class="form-label">Topical Medication Used:</label>
                <select class="form-control select2bs4"  style="width: 100%;" id="pvMedUsed">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>

            </div>

            <!-- Submit Button -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-success px-4" onclick="generatePVDischarge()">Generate</button>
              </div>
            </div>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>


<script>
function generatePVDischarge() {
  const duration = document.getElementById("pvDuration").value;
  const nature = document.getElementById("pvNature").value;
  const itchingDays = document.getElementById("pvItchingDuration").value;
  const lap = document.getElementById("pvLap").value;
  const meds = document.getElementById("pvMedUsed").value;

  const lapText = lap === "yes" ? "associated with LAP" : "not associated with LAP";
  const medText = meds === "yes" ? "has been on topical medication" : "has not been on topical medication";

  const sentence = `She has been experiencing PV discharge that has been there for the past ${duration} days. The PV discharge is ${nature.toLowerCase()} in nature and also associated with PV itching for ${itchingDays} days. The PV itching is ${lapText} and not associated with severe scratching. She ${medText}, and has had no relief since the start of symptoms.`;

  appendToHPI(sentence);
  $('#pvDischargeModal').modal('hide');
}

</script>

<!-- Painful Micturition Modal -->
<div class="modal fade" id="painfulMicturitionModal" tabindex="-1" role="dialog" aria-labelledby="painfulMicturitionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-md" role="document">
    <div class="modal-content shadow-lg rounded">
      
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="painfulMicturitionModalLabel">Painful Micturition - HPI Builder</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="painfulMicturitionForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Duration -->
              <div class="col-md-12">
                <label for="micturitionDays" class="form-label">Duration (in days):</label>
                <input type="number" id="micturitionDays" class="form-control" min="1" placeholder="e.g., 3">
              </div>

              <!-- Blood in urine -->
              <div class="col-md-12">
                <label for="micturitionBlood" class="form-label">Presence of blood in urine:</label>
                <select id="micturitionBlood" class="form-control select2bs4"  style="width: 100%;" >
                  <option value="no history of blood in urine">No</option>
                  <option value="a history of blood in urine">Yes</option>
                </select>
              </div>

              <!-- Pus in urine -->
              <div class="col-md-12">
                <label for="micturitionPus" class="form-label">Presence of pus in urine:</label>
                <select id="micturitionPus" class="form-control select2bs4"  style="width: 100%;" >
                  <option value="no history of pus in urine">No</option>
                  <option value="a history of pus in urine">Yes</option>
                </select>
              </div>

              <!-- Fever -->
              <div class="col-md-12">
                <label for="micturitionFever" class="form-label">Fever associated?</label>
                <select id="micturitionFever" class="form-control select2bs4"  style="width: 100%;" >
                  <option value="no history of fever associated with the painful micturition">No</option>
                  <option value="a history of fever associated with the painful micturition">Yes</option>
                </select>
              </div>

            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer justify-content-between">
        <button class="btn btn-danger px-4" onclick="generateMicturitionHPI()">Generate & Insert</button>
        <button class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      </div>

    </div>
  </div>
</div>


<script>
  function generateMicturitionHPI() {
    const days = document.getElementById('micturitionDays').value.trim();
    const blood = document.getElementById('micturitionBlood').value;
    const pus = document.getElementById('micturitionPus').value;
    const fever = document.getElementById('micturitionFever').value;

    let sentence = `The patient has been experiencing painful micturition that has been there over the past ${days} day(s), and this is mostly when passing urine, and not relieved by posture. There is ${blood} and also ${pus}. The patient has ${fever}.`;

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#painfulMicturitionModal').modal('hide');
  }
</script>


<!-- Joint Pain Modal -->
<div class="modal fade" id="jointPainModal" tabindex="-1" role="dialog" aria-labelledby="jointPainModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content shadow rounded-3 border-0">
      
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title" id="jointPainModalLabel">Joint Pain - HPI Builder</h5>
        <button type="button" class="btn-close btn-close-white" data-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form id="jointPainForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Onset -->
              <div class="col-md-4">
                <label for="jointPainOnset" class="form-label">Onset</label>
                <select id="jointPainOnset" class="form-control select2bs4"  style="width: 100%;" >
                  <option value="suddenly">Suddenly</option>
                  <option value="gradually">Gradually</option>
                </select>
              </div>

              <!-- Distribution -->
              <div class="col-md-4">
                <label for="jointPainDistribution" class="form-label">Distribution</label>
                <select id="jointPainDistribution" class="form-control select2bs4"  style="width: 100%;"  onchange="toggleJointLocationInput()">
                  <option value="generalized">Generalized</option>
                  <option value="localized">Localized</option>
                </select>
              </div>

              <!-- Location -->
              <div class="col-md-4" id="jointPainLocationGroup" style="display: none;">
                <label for="jointPainLocation" class="form-label">Location</label>
                <input type="text" id="jointPainLocation" class="form-control" placeholder="e.g., knees, elbows">
              </div>

              <!-- Associated with movement -->
              <div class="col-md-4">
                <label for="jointPainMovement" class="form-label">Associated with movement?</label>
                <select id="jointPainMovement" class="form-control select2bs4"  style="width: 100%;" >
                  <option value="is associated with movement">Yes</option>
                  <option value="is not associated with movement">No</option>
                </select>
              </div>

              <!-- Relieved by rest -->
              <div class="col-md-4">
                <label for="jointPainRelief" class="form-label">Relieved by rest?</label>
                <select id="jointPainRelief" class="form-control select2bs4"  style="width: 100%;" >
                  <option value="is relieved with resting posture">Yes</option>
                  <option value="is not relieved with resting posture">No</option>
                </select>
              </div>

              <!-- Medication taken -->
              <div class="col-md-4">
                <label for="jointPainMedication" class="form-label">Medication taken?</label>
                <select id="jointPainMedication" class="form-control select2bs4"  style="width: 100%;" >
                  <option value="no history of taking medication">No</option>
                  <option value="history of taking medication">Yes</option>
                </select>
              </div>

              <!-- Topical medication result -->
              <div class="col-md-4">
                <label for="jointPainTopical" class="form-label">Topical medication result</label>
                <select id="jointPainTopical" class="form-control select2bs4"  style="width: 100%;" >
                  <option value="not successful with application of topical medications">Not successful</option>
                  <option value="some relief with application of topical medications">Some relief</option>
                </select>
              </div>

            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer justify-content-between">
        <button type="button" class="btn btn-info px-4" onclick="generateJointPainHPI()">Generate & Insert</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      </div>

    </div>
  </div>
</div>

<script>
  function toggleJointLocationInput() {
    const dist = document.getElementById("jointPainDistribution").value;
    const locGroup = document.getElementById("jointPainLocationGroup");
    locGroup.style.display = dist === "localized" ? "block" : "none";
  }
</script>



<script>
  document.getElementById('jointPainDistribution').addEventListener('change', function () {
    document.getElementById('jointPainLocationGroup').style.display = this.value === 'localized' ? 'block' : 'none';
  });

  function generateJointPainHPI() {
    const onset = document.getElementById('jointPainOnset').value;
    const distribution = document.getElementById('jointPainDistribution').value;
    const location = document.getElementById('jointPainLocation').value.trim();
    const movement = document.getElementById('jointPainMovement').value;
    const relief = document.getElementById('jointPainRelief').value;
    const medication = document.getElementById('jointPainMedication').value;
    const topical = document.getElementById('jointPainTopical').value;

    let sentence = `The patient has joint pain that started ${onset} and is more ${distribution}`;
    if (distribution === 'localized' && location) {
      sentence += ` at the ${location}`;
    }
    sentence += `. The pain ${movement}, and ${relief}. There is ${medication} to relieve the pain, and this has been ${topical}.`;

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#jointPainModal').modal('hide');
  }
</script>

<!-- Back Pain Modal -->
<div class="modal fade" id="backPainModal" tabindex="-1" role="dialog" aria-labelledby="backPainModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow rounded border-0">

      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="backPainModalLabel">Back Pain - HPI Builder</h5>
        <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form id="backPainForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Onset -->
              <div class="col-md-4">
                <label for="backPainOnset" class="form-label">Onset</label>
                <select id="backPainOnset" class="form-control select2bs4" style="width: 100%;">
                  <option value="suddenly">Suddenly</option>
                  <option value="gradually">Gradually</option>
                </select>
              </div>

              <!-- Distribution -->
              <div class="col-md-4">
                <label for="backPainDistribution" class="form-label">Distribution</label>
                <select id="backPainDistribution" class="form-control select2bs4" style="width: 100%;" onchange="toggleBackLocationInput()">
                  <option value="generalized">Generalized</option>
                  <option value="localized">Localized</option>
                </select>
              </div>

              <!-- Location (conditional) -->
              <div class="col-md-4" id="backPainLocationGroup" style="display: none;">
                <label for="backPainLocation" class="form-label">Location (if localized)</label>
                <input type="text" id="backPainLocation" class="form-control" placeholder="e.g., lower back, lumbar region" />
              </div>

              <!-- Associated with movement -->
              <div class="col-md-4">
                <label for="backPainMovement" class="form-label">Associated with movement?</label>
                <select id="backPainMovement" class="form-control select2bs4" style="width: 100%;">
                  <option value="is associated with movement">Yes</option>
                  <option value="is not associated with movement">No</option>
                </select>
              </div>

              <!-- Relieved by rest -->
              <div class="col-md-4">
                <label for="backPainRelief" class="form-label">Relieved by rest?</label>
                <select id="backPainRelief" class="form-control select2bs4" style="width: 100%;">
                  <option value="is relieved with resting posture">Yes</option>
                  <option value="is not relieved with resting posture">No</option>
                </select>
              </div>

              <!-- Medication taken -->
              <div class="col-md-4">
                <label for="backPainMedication" class="form-label">Medication taken?</label>
                <select id="backPainMedication" class="form-control select2bs4" style="width: 100%;">
                  <option value="no history of taking medication">No</option>
                  <option value="history of taking medication">Yes</option>
                </select>
              </div>

              <!-- Topical medication result -->
              <div class="col-md-4">
                <label for="backPainTopical" class="form-label">Topical medication result</label>
                <select id="backPainTopical" class="form-control select2bs4" style="width: 100%;">
                  <option value="not successful with application of topical medications">Not successful</option>
                  <option value="some relief with application of topical medications">Some relief</option>
                </select>
              </div>

            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer justify-content-between">
        <button type="button" class="btn btn-warning px-4" onclick="generateBackPainHPI()">Generate & Insert</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      </div>

    </div>
  </div>
</div>

<script>
  function toggleBackLocationInput() {
    const dist = document.getElementById("backPainDistribution").value;
    const locGroup = document.getElementById("backPainLocationGroup");
    locGroup.style.display = dist === "localized" ? "block" : "none";
  }
</script>

<script>
  document.getElementById('backPainDistribution').addEventListener('change', function () {
    document.getElementById('backPainLocationGroup').style.display = this.value === 'localized' ? 'block' : 'none';
  });

  function generateBackPainHPI() {
    const onset = document.getElementById('backPainOnset').value;
    const distribution = document.getElementById('backPainDistribution').value;
    const location = document.getElementById('backPainLocation').value.trim();
    const movement = document.getElementById('backPainMovement').value;
    const relief = document.getElementById('backPainRelief').value;
    const medication = document.getElementById('backPainMedication').value;
    const topical = document.getElementById('backPainTopical').value;

    let sentence = `The patient has back pain that started ${onset} and is more ${distribution}`;
    if (distribution === 'localized' && location) {
      sentence += ` at the ${location}`;
    }
    sentence += `. The back pain ${movement}, and ${relief}. There is ${medication} to relieve the pain, and this has been ${topical}.`;

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#backPainModal').modal('hide');
  }
</script>

<!-- Rashes Modal -->
<div class="modal fade" id="rashesModal" tabindex="-1" role="dialog" aria-labelledby="rashesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow rounded border-0">

      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="rashesModalLabel">Rashes - HPI Builder</h5>
        <button type="button" class="close btn-close-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="rashesForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Duration -->
              <div class="col-md-4">
                <label for="rashesDuration" class="form-label">Duration</label>
                <input type="text" id="rashesDuration" class="form-control" placeholder="e.g., 3 days, one week" />
              </div>

              <!-- Itching -->
              <div class="col-md-4">
                <label for="rashesItching" class="form-label">Itching</label>
                <select id="rashesItching" class="form-control select2bs4" style="width: 100%;">
                  <option value="has itching">Has itching</option>
                  <option value="no itching">No itching</option>
                </select>
              </div>

              <!-- Distribution -->
              <div class="col-md-4">
                <label for="rashesDistribution" class="form-label">Distribution</label>
                <select id="rashesDistribution" class="form-control select2bs4" style="width: 100%;" onchange="toggleRashLocationInput()">
                  <option value="more generalized">More generalized</option>
                  <option value="localized">Localized</option>
                </select>
              </div>

              <!-- Location (if localized) -->
              <div class="col-md-4" id="rashesLocationGroup" style="display: none;">
                <label for="rashesLocation" class="form-label">Location (if localized)</label>
                <input type="text" id="rashesLocation" class="form-control" placeholder="e.g., arms, legs, face" />
              </div>

              <!-- Medication History -->
              <div class="col-md-4">
                <label for="rashesMedication" class="form-label">Medication History</label>
                <select id="rashesMedication" class="form-control select2bs4" style="width: 100%;">
                  <option value="has been">Has been</option>
                  <option value="has not been">Has not been</option>
                </select>
              </div>

            </div>

            <!-- Buttons Row -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-danger px-4" onclick="generateRashesHPI()">Generate & Insert</button>
              </div>
            </div>

          </div>
        </form>
      </div>

    </div>
  </div>
</div>


<script>
  function toggleRashLocationInput() {
    const dist = document.getElementById("rashesDistribution").value;
    const locGroup = document.getElementById("rashesLocationGroup");
    locGroup.style.display = dist === "localized" ? "block" : "none";
  }
</script>


<script>
  document.getElementById('rashesDistribution').addEventListener('change', function () {
    const locGroup = document.getElementById('rashesLocationGroup');
    locGroup.style.display = this.value === 'localized' ? 'block' : 'none';
  });

  function generateRashesHPI() {
    const duration = document.getElementById('rashesDuration').value.trim();
    const itching = document.getElementById('rashesItching').value;
    const distribution = document.getElementById('rashesDistribution').value;
    const location = document.getElementById('rashesLocation').value.trim();
    const medication = document.getElementById('rashesMedication').value;

    let sentence = `The patient has been having rashes that have been there for the past ${duration}, and this has resulted in discomfort. `;
    sentence += `The rashes ${itching} that has accompanied the rashes, and these are ${distribution}`;
    if (distribution === 'localized' && location) {
      sentence += ` in ${location}`;
    }
    sentence += `. The patient ${medication} on any medication lately and this has resulted in no improvement to the condition.`;

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#rashesModal').modal('hide');
  }
</script>


<!-- Generalized Malaise Modal -->
<div class="modal fade" id="gbmModal" tabindex="-1" role="dialog" aria-labelledby="gbmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow rounded">

      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="gbmModalLabel">Generalized Malaise - HPI Builder</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="gbmForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Onset -->
              <div class="col-md-4">
                <label for="gbmOnset" class="form-label">Onset</label>
                <select class="form-control select2bs4" style="width: 100%;" id="gbmOnset">
                  <option value="started gradually">Gradual</option>
                  <option value="started suddenly">Sudden</option>
                </select>
              </div>

              <!-- Associated Factors -->
              <div class="col-md-4">
                <label for="gbmAssociatedFactors" class="form-label">Associated Factors</label>
                <input type="text" class="form-control" id="gbmAssociatedFactors" placeholder="e.g., fever, weakness">
              </div>

              <!-- Relation to Rest/Work -->
              <div class="col-md-4">
                <label for="gbmRelation" class="form-label">Relation to Rest/Work</label>
                <select class="form-control select2bs4" style="width: 100%;" id="gbmRelation">
                  <option value="mostly not related to the resting situation and also not related to work activities">
                    Not related to rest or work
                  </option>
                  <option value="worsens with rest and improves with activity">Worsens with rest</option>
                  <option value="worsens with work and improves with rest">Worsens with work</option>
                </select>
              </div>

            </div>

            <!-- Buttons Row -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-warning px-4" onclick="generateGBMHPI()">Generate & Insert</button>
              </div>
            </div>

          </div>
        </form>
      </div>

    </div>
  </div>
</div>


<script>
  function generateGBMHPI() {
    const onset = document.getElementById('gbmOnset').value;
    const relation = document.getElementById('gbmRelation').value;
    const associated = document.getElementById('gbmAssociatedFactors').value.trim();

    let sentence = `Patient has been having generalized malaise that ${onset} and has been ${relation}.`;
    if (associated) {
      sentence += ` The GBM has been associated with ${associated}.`;
    }

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#gbmModal').modal('hide');
  }
</script>


<!-- Gaseous Discomfort Modal -->
<div class="modal fade" id="gaseousDiscomfortModal" tabindex="-1" role="dialog" aria-labelledby="gaseousDiscomfortModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow-lg rounded">

      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="gaseousDiscomfortModalLabel">Gaseous Discomfort - HPI Builder</h5>
        <button type="button" class="close btn-close-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="gaseousDiscomfortForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Duration -->
              <div class="col-md-4">
                <label for="gaseousDiscomfortDays" class="form-label">Duration (days)</label>
                <input type="number" class="form-control" id="gaseousDiscomfortDays" min="0" placeholder="Enter number of days">
              </div>

              <!-- Medication Taken -->
              <div class="col-md-4">
                <label for="gaseousDiscomfortMedication" class="form-label">Medication Taken</label>
                <select class="form-control select2bs4" style="width: 100%;" id="gaseousDiscomfortMedication">
                  <option value="has not been on medication to relieve the current discomfort">No</option>
                  <option value="has been on medication to relieve the current discomfort">Yes</option>
                </select>
              </div>

              <!-- Blood in Stool -->
              <div class="col-md-4">
                <label for="gaseousDiscomfortBloodStool" class="form-label">Blood in Stool</label>
                <select class="form-control select2bs4" style="width: 100%;" id="gaseousDiscomfortBloodStool">
                  <option value="There is no history of blood in stool">No</option>
                  <option value="There is history of blood in stool">Yes</option>
                </select>
              </div>

              <!-- Diarrhea -->
              <div class="col-md-4">
                <label for="gaseousDiscomfortDiarrhea" class="form-label">Diarrhea</label>
                <select class="form-control select2bs4" style="width: 100%;" id="gaseousDiscomfortDiarrhea">
                  <option value="there is no history of diarrhea">No</option>
                  <option value="there is history of diarrhea">Yes</option>
                </select>
              </div>

            </div>

            <!-- Button Row -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-success px-4" onclick="generateGaseousDiscomfortHPI()">Generate & Insert</button>
              </div>
            </div>

          </div>
        </form>
      </div>

    </div>
  </div>
</div>


    
<script>
  function generateGaseousDiscomfortHPI() {
    const days = document.getElementById('gaseousDiscomfortDays').value || 'several';
    const medication = document.getElementById('gaseousDiscomfortMedication').value;
    const bloodStool = document.getElementById('gaseousDiscomfortBloodStool').value;
    const diarrhea = document.getElementById('gaseousDiscomfortDiarrhea').value;

    const sentence = `Patient has been experiencing gaseous discomfort that started ${days} days ago and this has resulted in severe inability to consume enough food and also associated with inability to have a comfortable daily routine. The patient ${medication}. ${bloodStool}, and also ${diarrhea}.`;

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#gaseousDiscomfortModal').modal('hide');
  }
</script>


<!-- Chest Pain Modal -->
<div class="modal fade" id="chestPainModal" tabindex="-1" role="dialog" aria-labelledby="chestPainModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow-lg rounded">

      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="chestPainModalLabel">Chest Pain - HPI Builder</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="chestPainForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Duration -->
              <div class="col-md-4">
                <label for="chestPainDaysAgo" class="form-label">Duration (days)</label>
                <input type="number" class="form-control" id="chestPainDaysAgo" min="0" placeholder="Enter number of days">
              </div>

              <!-- Location -->
              <div class="col-md-4">
                <label for="chestPainLocation" class="form-label">Location</label>
                <select class="form-control select2bs4" style="width: 100%;" id="chestPainLocation">
                  <option value="central">Central</option>
                  <option value="generalized">Generalized</option>
                </select>
              </div>

              <!-- Radiation -->
              <div class="col-md-4">
                <label for="chestPainRadiation" class="form-label">Radiation</label>
                <select class="form-control select2bs4" style="width: 100%;" id="chestPainRadiation">
                  <option value="non-radiating">Non-radiating</option>
                  <option value="radiating">Radiating</option>
                </select>
              </div>

              <!-- Cough Association -->
              <div class="col-md-4">
                <label for="chestPainCough" class="form-label">Associated with Cough?</label>
                <select class="form-control select2bs4" style="width: 100%;" id="chestPainCough">
                  <option value="not associated with cough">No</option>
                  <option value="associated with cough">Yes</option>
                </select>
              </div>

              <!-- Fever Association -->
              <div class="col-md-4">
                <label for="chestPainFever" class="form-label">Associated with Fever?</label>
                <select class="form-control select2bs4" style="width: 100%;" id="chestPainFever">
                  <option value="not associated with fever">No</option>
                  <option value="associated with fever">Yes</option>
                </select>
              </div>

            </div>

            <!-- Button Row -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-warning px-4" onclick="generateChestPainHPI()">Generate & Insert</button>
              </div>
            </div>

          </div>
        </form>
      </div>

    </div>
  </div>
</div>



<script>
  function generateChestPainHPI() {
    const days = document.getElementById('chestPainDaysAgo').value || 'a few';
    const location = document.getElementById('chestPainLocation').value;
    const radiation = document.getElementById('chestPainRadiation').value;
    const cough = document.getElementById('chestPainCough').value;
    const fever = document.getElementById('chestPainFever').value;

    const sentence = `Patient has chest pain that has been there for ${days} days and is mostly ${location} and is ${radiation} pain. Chest pain is ${cough}, and is ${fever}.`;

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#chestPainModal').modal('hide');
  }
</script>


<!-- Difficulty in Breathing Modal -->
<div class="modal fade" id="dibModal" tabindex="-1" role="dialog" aria-labelledby="dibModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow-lg rounded">

      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="dibModalLabel">Difficulty in Breathing - HPI Builder</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="dibForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Duration -->
              <div class="col-md-4">
                <label for="dibDaysAgo" class="form-label">Duration (days)</label>
                <input type="number" class="form-control" id="dibDaysAgo" min="0" placeholder="Enter number of days">
              </div>

              <!-- Location -->
              <div class="col-md-4">
                <label for="dibLocation" class="form-label">Location</label>
                <select class="form-control select2bs4" style="width: 100%;" id="dibLocation">
                  <option value="central">Central</option>
                  <option value="generalized">Generalized</option>
                </select>
              </div>

              <!-- Radiation -->
              <div class="col-md-4">
                <label for="dibRadiation" class="form-label">Radiation</label>
                <select class="form-control select2bs4" style="width: 100%;" id="dibRadiation">
                  <option value="non-radiating">Non-radiating</option>
                  <option value="radiating">Radiating</option>
                </select>
              </div>

              <!-- Cough Association -->
              <div class="col-md-4">
                <label for="dibCough" class="form-label">Associated with Cough?</label>
                <select class="form-control select2bs4" style="width: 100%;" id="dibCough">
                  <option value="not associated with cough">No</option>
                  <option value="associated with cough">Yes</option>
                </select>
              </div>

              <!-- Fever Association -->
              <div class="col-md-4">
                <label for="dibFever" class="form-label">Associated with Fever?</label>
                <select class="form-control select2bs4" style="width: 100%;" id="dibFever">
                  <option value="not associated with fever">No</option>
                  <option value="associated with fever">Yes</option>
                </select>
              </div>

            </div>

            <!-- Button Row -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-danger px-4" onclick="generateDibHPI()">Generate & Insert</button>
              </div>
            </div>

          </div>
        </form>
      </div>

    </div>
  </div>
</div>


<script>
  function generateDibHPI() {
    const days = document.getElementById('dibDaysAgo').value || 'a few';
    const location = document.getElementById('dibLocation').value;
    const radiation = document.getElementById('dibRadiation').value;
    const cough = document.getElementById('dibCough').value;
    const fever = document.getElementById('dibFever').value;

    const sentence = `Patient has difficulty in breathing that has been there for ${days} days and is mostly ${location} and is ${radiation} pain. DIB is ${cough}, and is ${fever}.`;

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#dibModal').modal('hide');
  }
</script>



<!-- Cough Modal -->
<div class="modal fade" id="coughModal" tabindex="-1" role="dialog" aria-labelledby="coughModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow-lg rounded">

      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="coughModalLabel">Cough - HPI Builder</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="coughForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Cough Start Days Ago -->
              <div class="col-md-4">
                <label for="coughDaysAgo" class="form-label">When did the cough start? (days ago)</label>
                <input type="number" class="form-control" id="coughDaysAgo" min="0" placeholder="e.g. 3">
              </div>

              <!-- Periodicity -->
              <div class="col-md-4">
                <label for="coughPeriodicity" class="form-label">Periodicity of Cough</label>
                <select class="form-control select2bs4" style="width: 100%;" id="coughPeriodicity">
                  <option value="non-specific">Non-specific</option>
                  <option value="mostly at day">Mostly at day</option>
                  <option value="mostly at night">Mostly at night</option>
                </select>
              </div>

              <!-- Sputum Nature -->
              <div class="col-md-4">
                <label for="coughSputum" class="form-label">Nature of Sputum</label>
                <select class="form-control select2bs4" style="width: 100%;" id="coughSputum">
                  <option value="non-productive">Non-productive</option>
                  <option value="productive with yellow sputum">Productive with yellow sputum</option>
                </select>
              </div>

              <!-- Blood Stained Sputum -->
              <div class="col-md-4">
                <label for="coughBlood" class="form-label">Is sputum blood stained?</label>
                <select class="form-control select2bs4" style="width: 100%;" id="coughBlood">
                  <option value="non-blood stained">No</option>
                  <option value="blood stained">Yes</option>
                </select>
              </div>

              <!-- Difficulty in Breathing -->
              <div class="col-md-4">
                <label for="coughBreathing" class="form-label">Associated with Difficulty in Breathing?</label>
                <select class="form-control select2bs4" style="width: 100%;" id="coughBreathing">
                  <option value="not associated with difficulty in breathing">No</option>
                  <option value="associated with difficulty in breathing">Yes</option>
                </select>
              </div>

              <!-- Chest Pain -->
              <div class="col-md-4">
                <label for="coughPain" class="form-label">Associated with Chest Pain?</label>
                <select class="form-control select2bs4" style="width: 100%;" id="coughPain">
                  <option value="not associated with chest pain">No</option>
                  <option value="associated with chest pain">Yes</option>
                </select>
              </div>

            </div>

            <!-- Button Row -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-warning px-4" onclick="generateCoughHPI()">Generate & Insert</button>
              </div>
            </div>

          </div>
        </form>
      </div>

    </div>
  </div>
</div>



<script>
  function generateCoughHPI() {
    const days = document.getElementById('coughDaysAgo').value || 'a few';
    const periodicity = document.getElementById('coughPeriodicity').value;
    const sputum = document.getElementById('coughSputum').value;
    const blood = document.getElementById('coughBlood').value;
    const breathing = document.getElementById('coughBreathing').value;
    const pain = document.getElementById('coughPain').value;

    const sentence = `Patient has cough that started ${days} days ago and this is mostly ${periodicity} in periodicity. The cough is ${sputum} in nature, ${blood}. Cough is ${breathing}, and is ${pain}.`;

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#coughModal').modal('hide');
  }
</script>

<!-- Flu Modal -->
<div class="modal fade" id="fluModal" tabindex="-1" role="dialog" aria-labelledby="fluModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow-lg rounded">

      <div class="modal-header bg-info text-white">
        <h5 class="modal-title" id="fluModalLabel">Flu - HPI Builder</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="fluForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Flu Start Days Ago -->
              <div class="col-md-4">
                <label for="fluDaysAgo" class="form-label">When did the flu start? (days ago)</label>
                <input type="number" class="form-control" id="fluDaysAgo" min="0" placeholder="e.g. 2">
              </div>

              <!-- Primary Symptom -->
              <div class="col-md-4">
                <label for="fluPrimarySymptom" class="form-label">Primary Symptom Caused</label>
                <select class="form-control select2bs4" style="width: 100%;" id="fluPrimarySymptom">
                  <option value="nose congestion">Nose Congestion</option>
                  <option value="nose dribbling">Nose Dribbling</option>
                </select>
              </div>

              <!-- Malaise Status -->
              <div class="col-md-4">
                <label for="fluMalaise" class="form-label">Malaise Status</label>
                <select class="form-control select2bs4" style="width: 100%;" id="fluMalaise">
                  <option value="generalized malaise which has been there since the same time">Yes</option>
                  <option value="no significant malaise">No</option>
                </select>
              </div>

              <!-- Feeling of Unease -->
              <div class="col-md-4">
                <label for="fluUnease" class="form-label">Feeling of Unease</label>
                <select class="form-control select2bs4" style="width: 100%;" id="fluUnease">
                  <option value="resulting in a feeling of unease">Yes</option>
                  <option value="no complaint of unease">No</option>
                </select>
              </div>

              <!-- Empty space to balance layout -->
              <div class="col-md-8"></div>

            </div>

            <!-- Submit Button Row -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-info px-4" onclick="generateFluHPI()">Generate & Insert</button>
              </div>
            </div>

          </div>
        </form>
      </div>

    </div>
  </div>
</div>




<script>
  function generateFluHPI() {
    const days = document.getElementById('fluDaysAgo').value || 'a few';
    const symptom = document.getElementById('fluPrimarySymptom').value;
    const malaise = document.getElementById('fluMalaise').value;
    const unease = document.getElementById('fluUnease').value;

    const sentence = `Patient has flu that started about ${days} days ago and this has resulted in ${symptom}, and ${malaise}, ${unease}.`;

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#fluModal').modal('hide');
  }
</script>


<!-- Headache Modal -->
<div class="modal fade" id="headacheModal" tabindex="-1" role="dialog" aria-labelledby="headacheModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow-lg rounded">

      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="headacheModalLabel">Headache - HPI Builder</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="headacheForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Headache Location -->
              <div class="col-md-4">
                <label for="headacheLocation" class="form-label">Location</label>
                <select class="form-control select2bs4" style="width: 100%;" id="headacheLocation">
                  <option value="generalized and not localized on one site">Generalized</option>
                  <option value="localized to the frontal region">Frontal</option>
                  <option value="localized to the side">Side</option>
                  <option value="localized to the back of the head">Back</option>
                </select>
              </div>

              <!-- Severity -->
              <div class="col-md-4">
                <label for="headacheSeverity" class="form-label">Severity</label>
                <select class="form-control select2bs4" style="width: 100%;" id="headacheSeverity">
                  <option value="resulting in severe discomfort">Severe</option>
                  <option value="mild and manageable">Mild</option>
                </select>
              </div>

              <!-- Running Nose -->
              <div class="col-md-4">
                <label for="headacheRunningNose" class="form-label">Running Nose</label>
                <select class="form-control select2bs4" style="width: 100%;" id="headacheRunningNose">
                  <option value="not associated with running nose">Not Associated</option>
                  <option value="associated with running nose">Associated</option>
                </select>
              </div>

              <!-- Nose Congestion -->
              <div class="col-md-4">
                <label for="headacheNoseCongestion" class="form-label">Nose Congestion</label>
                <select class="form-control select2bs4" style="width: 100%;" id="headacheNoseCongestion">
                  <option value="not associated with nose congestion">Not Associated</option>
                  <option value="associated with nose congestion">Associated</option>
                </select>
              </div>

              <!-- Fever History -->
              <div class="col-md-4">
                <label for="headacheFeverHistory" class="form-label">History of Fever</label>
                <select class="form-control select2bs4" style="width: 100%;" id="headacheFeverHistory">
                  <option value="There is no history of fever">No</option>
                  <option value="There is history of fever">Yes</option>
                </select>
              </div>

              <!-- Injury History -->
              <div class="col-md-4">
                <label for="headacheInjury" class="form-label">History of Injury</label>
                <select class="form-control select2bs4" style="width: 100%;" id="headacheInjury">
                  <option value="There is no history of injury">No</option>
                  <option value="There is history of injury">Yes</option>
                </select>
              </div>

            </div>

            <!-- Submit Button -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-warning px-4" onclick="generateHeadacheHPI()">Generate & Insert</button>
              </div>
            </div>

          </div>
        </form>
      </div>

    </div>
  </div>
</div>

<script>
  function generateHeadacheHPI() {
    const location = document.getElementById('headacheLocation').value;
    const severity = document.getElementById('headacheSeverity').value;
    const runningNose = document.getElementById('headacheRunningNose').value;
    const congestion = document.getElementById('headacheNoseCongestion').value;
    const feverHistory = document.getElementById('headacheFeverHistory').value;
    const injury = document.getElementById('headacheInjury').value;

    const sentence = `Patient presents with headache that is ${location} and has been ${severity}. Headache is ${runningNose} and is also ${congestion}. ${feverHistory}. ${injury}.`;

    const hpiTextarea = document.getElementById('hpi');
    hpiTextarea.value = hpiTextarea.value.trim()
      ? `${hpiTextarea.value.trim()}\n\n${sentence}`
      : sentence;

    $('#headacheModal').modal('hide');
  }
</script>


<!-- Fever Modal -->
<div class="modal fade" id="feverModal" tabindex="-1" role="dialog" aria-labelledby="feverModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content shadow-lg rounded">

      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="feverModalLabel">Fever - History of Presenting Illness (HPI)</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="feverHPIForm">
          <div class="container-fluid">
            <div class="row g-3">

              <!-- Grade of Fever -->
              <div class="col-md-4">
                <label for="feverGrade" class="form-label">Grade of Fever</label>
                <select class="form-control select2bs4" style="width: 100%;" id="feverGrade">
                  <option value="">-- Select --</option>
                  <option value="low grade">Low Grade</option>
                  <option value="high grade">High Grade</option>
                </select>
              </div>

              <!-- Fever Pattern -->
              <div class="col-md-4">
                <label for="feverPattern" class="form-label">Fever Pattern</label>
                <select class="form-control select2bs4" style="width: 100%;" id="feverPattern">
                  <option value="">-- Select --</option>
                  <option value="non-specific">Non-specific</option>
                  <option value="mostly at day">Mostly at Day</option>
                  <option value="mostly at night">Mostly at Night</option>
                </select>
              </div>

              <!-- Onset Type -->
              <div class="col-md-4">
                <label for="feverOnset" class="form-label">Onset Type</label>
                <select class="form-control select2bs4" style="width: 100%;" id="feverOnset">
                  <option value="">-- Select --</option>
                  <option value="sudden">Sudden</option>
                  <option value="gradual">Gradual</option>
                </select>
              </div>

              <!-- Duration (days) -->
              <div class="col-md-4">
                <label for="feverDuration" class="form-label">Duration (in days)</label>
                <input type="number" min="0" class="form-control" id="feverDuration" placeholder="Enter number of days">
              </div>

              <!-- Medication Taken -->
              <div class="col-md-4">
                <label for="feverMed" class="form-label">Taken Medication?</label>
                <select class="form-control select2bs4" style="width: 100%;" id="feverMed">
                  <option value="">-- Select --</option>
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>

              <!-- Empty col for alignment -->
              <div class="col-md-4"></div>

            </div>

            <!-- Submit Button -->
            <div class="row mt-4">
              <div class="col text-center">
                <button type="button" class="btn btn-success px-4" onclick="generateFeverHPI()">Generate HPI</button>
              </div>
            </div>
            
          </div>
        </form>
      </div>

    </div>
  </div>
</div>


<script>
  function generateFeverHPI() {
  const grade = document.getElementById('feverGrade').value;
  const pattern = document.getElementById('feverPattern').value;
  const onset = document.getElementById('feverOnset').value;
  const duration = document.getElementById('feverDuration').value;
  const med = document.getElementById('feverMed').value;

  if (!grade || !pattern || !onset || !duration || !med) {
    alert("Please fill all the fields to generate the HPI.");
    return;
  }

  const medText = med === 'yes'
    ? "The patient has been on medication related to relieving fever."
    : "The patient has not been on any medication related to relieving fever.";

  const feverHPI = `Patient presents with fever that is of ${grade} and is ${pattern}, started ${duration} day(s) ago and was ${onset} in onset. ${medText}`;

  const hpiTextarea = document.getElementById('hpi');
  hpiTextarea.value = hpiTextarea.value.trim()
    ? `${hpiTextarea.value.trim()}\n\n${feverHPI}`
    : feverHPI;

  $('#feverModal').modal('hide');
}

</script>


<!-- ROS Modal -->
<div class="modal fade" id="rosModal" tabindex="-1" role="dialog" aria-labelledby="rosModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Review of Systems (ROS)</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <!-- Normal / Abnormal toggle -->
        <div class="form-group">
          <label><strong>ROS Status:</strong></label>
          <select class="form-control" id="rosStatus">
            <option value="">-- Select ROS status --</option>
            <option value="normal">Normal</option>
            <option value="abnormal">Abnormal</option>
          </select>
        </div>

        <!-- ROS Options -->
        <div id="rosOptionsSection" style="display: none;">
          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" id="rosSelectAll">
            <label class="form-check-label font-weight-bold" for="rosSelectAll">Select All Systems</label>
          </div>

          <div class="container-fluid">
            <div class="row">
              <!-- Left Column -->
              <div class="col-md-6">
                <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="General" id="rosGeneral">
                  <label class="form-check-label" for="rosGeneral">General</label>
                  <textarea class="form-control ros-note mt-1" data-label="General" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
                <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="Skin" id="rosSkin">
                  <label class="form-check-label" for="rosSkin">Skin</label>
                  <textarea class="form-control ros-note mt-1" data-label="Skin" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
                <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="HEENT" id="rosHEENT">
                  <label class="form-check-label" for="rosHEENT">HEENT</label>
                  <textarea class="form-control ros-note mt-1" data-label="HEENT" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
                <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="Cardiovascular" id="rosCardio">
                  <label class="form-check-label" for="rosCardio">Cardiovascular</label>
                  <textarea class="form-control ros-note mt-1" data-label="Cardiovascular" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
                <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="Respiratory" id="rosRespiratory">
                  <label class="form-check-label" for="rosRespiratory">Respiratory</label>
                  <textarea class="form-control ros-note mt-1" data-label="Respiratory" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
              </div>

              <!-- Right Column -->
              <div class="col-md-6">
                <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="Gastrointestinal" id="rosGI">
                  <label class="form-check-label" for="rosGI">Gastrointestinal</label>
                  <textarea class="form-control ros-note mt-1" data-label="Gastrointestinal" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
                <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="Genitourinary" id="rosGU">
                  <label class="form-check-label" for="rosGU">Genitourinary</label>
                  <textarea class="form-control ros-note mt-1" data-label="Genitourinary" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
                <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="Musculoskeletal" id="rosMSK">
                  <label class="form-check-label" for="rosMSK">Musculoskeletal</label>
                  <textarea class="form-control ros-note mt-1" data-label="Musculoskeletal" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
                               <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="Neurological" id="rosNeuro">
                  <label class="form-check-label" for="rosNeuro">Neurological</label>
                  <textarea class="form-control ros-note mt-1" data-label="Neurological" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
                <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="Endocrine" id="rosEndocrine">
                  <label class="form-check-label" for="rosEndocrine">Endocrine</label>
                  <textarea class="form-control ros-note mt-1" data-label="Endocrine" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
                <div class="form-group">
                  <input type="checkbox" class="form-check-input ros-option" data-label="Hematological" id="rosHeme">
                  <label class="form-check-label" for="rosHeme">Hematological</label>
                  <textarea class="form-control ros-note mt-1" data-label="Hematological" rows="2" placeholder="Abnormal findings (optional)" disabled></textarea>
                </div>
              </div>
            </div>
          </div>
        </div> <!-- end #rosOptionsSection -->
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="generateRosSummary">Save</button>
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function () {

  // Show/hide ROS options based on status
  $('#rosStatus').on('change', function () {
    const status = $(this).val();
    if (status === 'abnormal') {
      $('#rosOptionsSection').show();
    } else {
      $('#rosOptionsSection').hide();
    }
  });

  // Enable/disable textarea with checkbox
  $('.ros-option').on('change', function () {
    const label = $(this).data('label');
    $(`.ros-note[data-label="${label}"]`).prop('disabled', !this.checked);
  });

  // Select all toggle
  $('#rosSelectAll').on('change', function () {
    const checked = this.checked;
    $('.ros-option').prop('checked', checked).trigger('change');
  });

  // Generate ROS summary
  $('#generateRosSummary').on('click', function () {
    const status = $('#rosStatus').val();
    let summary = '';

    if (status === 'normal') {
      summary = `Review of systems is normal. The patient denies symptoms in all systems.`;
    } else if (status === 'abnormal') {
      let abnormal = [];
      let normal = [];

      $('.ros-option').each(function () {
        const label = $(this).data('label');
        const isChecked = $(this).is(':checked');
        const note = $(`.ros-note[data-label="${label}"]`).val().trim();

        if (isChecked) {
          if (note) {
            abnormal.push(`${label}: ${note}`);
          } else {
            abnormal.push(`${label}: abnormal findings noted`);
          }
        } else {
          normal.push(label);
        }
      });

      summary = '';

      if (abnormal.length > 0) {
        summary += "Review of systems reveals the following abnormalities:\n" + abnormal.join("\n") + "\n\n";
      }

      if (normal.length > 0) {
        summary += "Other systems reviewed and found normal: " + normal.join(", ") + ".";
      }

      if (summary.trim() === '') {
        summary = "Review of systems abnormal, but no details provided.";
      }
    } else {
      summary = '';
    }

    $('#ros').val(summary.trim());
    $('#rosModal').modal('hide');
  });

});
</script>


<!-- Physical Examination Modal -->
<div class="modal fade" id="physicalExamModal" tabindex="-1" role="dialog" aria-labelledby="physicalExamModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Physical Examination</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p class="text-muted">Check abnormal systems and describe findings. Unchecked systems will be assumed normal.</p>
        <form id="physicalExamForm">
          <!-- Dynamic Fields -->
          <div class="form-check mb-2">
            <input class="form-check-input system-check" type="checkbox" id="chkHEENT" value="HEENT">
            <label class="form-check-label" for="chkHEENT">HEENT</label>
            <textarea class="form-control mt-1 system-detail d-none" id="txtHEENT" placeholder="Describe HEENT abnormal findings"></textarea>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input system-check" type="checkbox" id="chkCardiovascular" value="Cardiovascular">
            <label class="form-check-label" for="chkCardiovascular">Cardiovascular</label>
            <textarea class="form-control mt-1 system-detail d-none" id="txtCardiovascular" placeholder="Describe cardiovascular abnormal findings"></textarea>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input system-check" type="checkbox" id="chkRespiratory" value="Respiratory">
            <label class="form-check-label" for="chkRespiratory">Respiratory</label>
            <textarea class="form-control mt-1 system-detail d-none" id="txtRespiratory" placeholder="Describe respiratory abnormal findings"></textarea>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input system-check" type="checkbox" id="chkAbdomen" value="Abdomen">
            <label class="form-check-label" for="chkAbdomen">Abdomen (PA)</label>
            <textarea class="form-control mt-1 system-detail d-none" id="txtAbdomen" placeholder="Describe abdominal abnormal findings"></textarea>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input system-check" type="checkbox" id="chkMusculoskeletal" value="Musculoskeletal">
            <label class="form-check-label" for="chkMusculoskeletal">Musculoskeletal</label>
            <textarea class="form-control mt-1 system-detail d-none" id="txtMusculoskeletal" placeholder="Describe musculoskeletal abnormal findings"></textarea>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input system-check" type="checkbox" id="chkNeurological" value="Neurological">
            <label class="form-check-label" for="chkNeurological">Neurological</label>
            <textarea class="form-control mt-1 system-detail d-none" id="txtNeurological" placeholder="Describe neurological abnormal findings"></textarea>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input system-check" type="checkbox" id="chkSkin" value="Skin">
            <label class="form-check-label" for="chkSkin">Skin</label>
            <textarea class="form-control mt-1 system-detail d-none" id="txtSkin" placeholder="Describe skin abnormal findings"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" id="generatePhysicalExam">Save</button>
      </div>
    </div>
  </div>
</div>



<script>
  const defaultFindings = {
    "HEENT": "Normocephalic, atraumatic head; neck supple; PERRL.",
    "Cardiovascular": "Regular rate and rhythm; no murmurs, rubs, or gallops.",
    "Respiratory": "Clear to auscultation bilaterally; no wheezes, rales, or crackles.",
    "Abdomen": "Soft, non-tender, non-distended; normal bowel sounds; no masses or organomegaly.",
    "Musculoskeletal": "No deformities or scoliosis; atraumatic extremities.",
    "Neurological": "Normal strength, tone, ROM and gait; no focal deficits.",
    "Skin": "Warm, well-perfused; no rashes or lesions."
  };

  const allSections = Object.keys(defaultFindings);

  $(document).ready(function () {
    // Show/hide textareas on checkbox toggle
    $('.system-check').on('change', function () {
      const system = $(this).val();
      const textarea = $('#txt' + system);
      if (this.checked) {
        textarea.removeClass('d-none');
      } else {
        textarea.addClass('d-none').val('');
      }
    });

    // Generate and fill summary on save
    $('#generatePhysicalExam').on('click', function () {
      let summary = 'Physical Examination:\n\n';
      allSections.forEach(system => {
        const isChecked = $('#chk' + system).is(':checked');
        const findings = $('#txt' + system).val().trim();
        if (isChecked && findings) {
          summary += `${system}: ${findings}\n`;
        } else if (!isChecked) {
          summary += `${system}: ${defaultFindings[system]}\n`;
        }
      });
      $('#physical_examination').val(summary.trim());
      $('#physicalExamModal').modal('hide');
    });
  });
</script>




<script>
    $(document).ready(function () {
        // HPI
        $('#hpiModal').on('show.bs.modal', function () {
            $('#modalHpiText').val($('#hpi').val());
        });
        $('#saveHpiModal').on('click', function () {
            $('#hpi').val($('#modalHpiText').val());
            $('#hpiModal').modal('hide');
        });

        // ROS
        $('#rosModal').on('show.bs.modal', function () {
            $('#modalRosText').val($('#ros').val());
        });
        $('#saveRosModal').on('click', function () {
            $('#ros').val($('#modalRosText').val());
            $('#rosModal').modal('hide');
        });

        // Physical Examination
        $('#physicalExamModal').on('show.bs.modal', function () {
            $('#modalPhysicalExamText').val($('#physical_examination').val());
        });
        $('#savePhysicalExamModal').on('click', function () {
            $('#physical_examination').val($('#modalPhysicalExamText').val());
            $('#physicalExamModal').modal('hide');
        });
    });
</script>





    <!-- Modal -->
<div class="modal fade" id="addPatientVitalModal" tabindex="-1" role="dialog" aria-labelledby="addPatientVitalModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addPatientVitalModalLabel">Add Patient Vital</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="card">
            <div class="card-header">Add Patient Vital</div>
            <div class="card-body">
                <div id="VitalMessageContainer{{ vital.id }}" class="alert" role="alert"></div>
                <form method="post" id="AddPatientVitalForm">
                    {% csrf_token %}
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="respiratory_rate">Respiratory Rate (breaths per minute)</label>
                            <select class="form-control select2bs4" style="width: 100%;" id="respiratoryRate" name="respiratory_rate" required>
                                <option value=""></option>
                                {% for rate in range_15 %}
                                    <option value="{{ rate }}">{{ rate }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <input type="hidden" name="patient_id" id="patient_id" value="{{ patient.id }}">
                        <input type="hidden" name="vital_id" id="vital_id" value="">
                        <input type="hidden" class="form-control" id="visit_id" name="visit_id" value="{{ visit.id }}">
                        <div class="form-group col-md-6">
                            <label for="pulse_rate">Pulse Rate (beats per minute)</label>
                            <select class="form-control select2bs4" style="width: 100%;" id="pulseRate" name="pulse_rate" required>
                                <option value=""></option>
                                {% for rate in range_301 %}
                                    <option value="{{ rate }}">{{ rate }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="sbp">Systolic Blood Pressure (mmHg)</label>
                            <select class="form-control select2bs4" style="width: 100%;" id="sbp" name="sbp" required>
                                <option value=""></option>
                                {% for value in range_301 %}
                                    <option value="{{ value }}">{{ value }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="dbp">Diastolic Blood Pressure (mmHg)</label>
                            <select class="form-control select2bs4" style="width: 100%;" id="dbp" name="dbp" required>
                                <option value=""></option>
                                {% for value in range_301 %}
                                    <option value="{{ value }}">{{ value }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="avpu">AVPU Scale</label>
                            <select class="form-control select2bs4" style="width: 100%;" id="avpu" name="avpu" required>
                                <option value=""></option>
                                <option value="Alert">Alert</option>
                                <option value="Verbal">Verbal</option>
                                <option value="Pain">Pain</option>
                                <option value="Unresponsive">Unresponsive</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="spo2">SPO2 (%)</label>
                            <select class="form-control select2bs4" style="width: 100%;" id="spo2" name="spo2" required>
                                <option value=""></option>
                                {% for percentage in range_101 %}
                                    <option value="{{ percentage }}">{{ percentage }}%</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="temperature">Temperature (°C)</label>
                            <select class="form-control select2bs4" style="width: 100%;" id="temperature" name="temperature" required >
                                <option value=""></option>
                                {% for temp in temps %}
                                    <option value="{{ temp }}">{{ temp }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="gcs">Glasgow Coma Scale</label>
                            <select class="form-control select2bs4" style="width: 100%;" id="gcs" name="gcs" required>
                                <option value=""></option>
                                {% for score in range_15  %}
                                    <option value="{{ score }}">{{ score }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>                 
                      <!-- Row 5 -->
                      <div class="row">
                        <!-- Column 1 -->
                        <div class="col-md-6">
                            <div class="mb-3 form-group">
                                <label for="weight{{ vital.id }}" class="form-label">Weight</label>
                                <select class="form-control select2bs4" style="width: 100%;" id="weight{{ vital.id }}" name="weight" required>
                                    {% for weight in range_301 %}
                                        <option value="{{ weight }}">{{ weight }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>                                                                            
                    </div>
                    <div class="form-row">
                        <div class="col-md-12">
                            <button type="button" class="btn btn-primary btn-block" onclick="addRemotePatientVital()">Add new patient vital</button>
                        </div>
                    </div>
                
                </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
    
  <script>
    // Handle form submission using AJAX
    function addRemotePatientVital() {
        // Validate form fields
        if (!validateForm()) {
            return false;
        }

        // Prevent default form submission
        event.preventDefault();

        // Perform AJAX request
        $.ajax({
            type: 'POST',
            url: '{% url "doctor_save_remotepatient_vital" %}',  // Replace with your URL
            data: $('#AddPatientVitalForm').serialize(),
            success: function (response) {
                // If the request is successful, display a success message
                if (response.status) {
                    $('#VitalMessageContainer').html('<div class="alert alert-success">' + response.message + '</div>');
                    location.reload(true)
                } else {
                    $('#VitalMessageContainer').html('<div class="alert alert-danger">' + response.message + '</div>');
                }
            },
            error: function (xhr, error) {
                // If the request fails, display an error message
                $('#VitalMessageContainer').html('<div class="alert alert-danger">Error: ' + xhr.responseText + '</div>');
            }
        });
    }

    // Validate form fields
    function validateForm() {
        var isValid = true;
        $('#AddPatientVitalForm :required').each(function () {
            if ($(this).val() === '') {
                isValid = false;
                $(this).addClass('is-invalid');
            } else {
                $(this).removeClass('is-invalid');
            }
        });
        return isValid;
    }
</script>


    {% include 'doctor_template/datatable.html' %}     
{% endblock main_content %}
