{% extends 'hod_template/base_template.html' %}
{% load static %}

{% block title %}
Edit Staff | {{ staff.admin.first_name }} {{ staff.admin.last_name }}
{% endblock title %}

{% block page_title %}
<div class="d-flex justify-content-between align-items-center">
    <h4 class="page-title-premium mb-0">Edit Staff Profile</h4>
    <a href="{% url 'resa_admin_manage_staff' %}" class="btn pat-prem-btn-action">
        <i class="fas fa-arrow-left mr-1"></i> Back to Staff List
    </a>
</div>
{% endblock page_title %}

{% block main_content %}
<style>
    /* Premium styling for staff edit form */
    .pat-prem-gradient {
        background: linear-gradient(120deg, #1a2a6c, #2C3E50);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 15px 35px rgba(26, 42, 108, 0.15);
        border: none;
    }
    
    .pat-prem-gradient .card-header {
        background: rgba(0,0,0,0.1);
        border-bottom: 1px solid rgba(255,255,255,0.2);
        padding: 1.2rem 1.5rem;
    }
    
    .pat-prem-form-card {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        border: none;
        margin-bottom: 20px;
        transition: all 0.3s ease;
    }
    
    .pat-prem-form-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    
    .pat-prem-form-card .card-header {
        background: linear-gradient(120deg, #e3f2fd, #E3F2FD);
        color: #0d47a1;
        font-weight: 600;
        padding: 1rem 1.2rem;
        border-bottom: 1px solid #BBDEFB;
    }
    
    .pat-prem-form-card .card-body {
        padding: 1.5rem;
    }
    
    .pat-prem-form-control {
        border-radius: 8px;
        border: 1px solid #BBDEFB;
        padding: 10px 15px;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.9);
    }
    
    .pat-prem-form-control:focus {
        box-shadow: 0 0 0 0.2rem rgba(13, 71, 161, 0.25);
        border-color: #0d47a1;
        background: white;
    }
    
    .pat-prem-select2 .select2-selection {
        border-radius: 8px;
        border: 1px solid #BBDEFB;
        padding: 5px;
        height: auto;
        background: rgba(255, 255, 255, 0.9);
    }
    
    .pat-prem-select2 .select2-selection:focus {
        box-shadow: 0 0 0 0.2rem rgba(13, 71, 161, 0.25);
        border-color: #0d47a1;
        background: white;
    }
    
    .pat-prem-btn-action {
        background: linear-gradient(120deg, #1a2a6c, #2C3E50);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 20px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(26, 42, 108, 0.2);
        margin: 2px;
    }
    
    .pat-prem-btn-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(26, 42, 108, 0.3);
        color: white;
    }
    
    .pat-prem-btn-success {
        background: linear-gradient(120deg, #308829, #4CAF50);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 20px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(48, 136, 41, 0.2);
        margin: 2px;
    }
    
    .pat-prem-btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(48, 136, 41, 0.3);
        color: white;
    }
    
    .form-section-header {
        background: linear-gradient(120deg, #e3f2fd, #E3F2FD);
        color: #0d47a1;
        padding: 10px 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-weight: 600;
        display: flex;
        align-items: center;
    }
    
    .form-section-header i {
        margin-right: 10px;
        font-size: 1.2rem;
    }
    
    .page-title-premium {
        background: linear-gradient(120deg, #1a2a6c, #2C3E50);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .staff-profile-header {
        display: flex;
        align-items: center;
        margin-bottom: 25px;
        background: linear-gradient(120deg, #1a2a6c, #2C3E50);
        padding: 15px;
        border-radius: 10px;
        color: white;
    }
    
    .staff-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid white;
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        margin-right: 20px;
    }
    
    .staff-info {
        flex: 1;
    }
    
    .staff-name {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 5px;
    }
    
    .staff-details {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .staff-detail-item {
        display: flex;
        align-items: center;
        font-size: 0.9rem;
    }
    
    .staff-detail-item i {
        margin-right: 5px;
        font-size: 0.8rem;
    }
    
    @keyframes patPremFadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .pat-prem-animated {
        animation: patPremFadeIn 0.5s ease forwards;
    }
    
    .validation-feedback {
        display: block;
        width: 100%;
        margin-top: 0.25rem;
        font-size: 0.8rem;
        padding: 5px 10px;
        border-radius: 4px;
    }
    
    .invalid-feedback {
        color: #dc3545;
        background: rgba(220, 53, 69, 0.1);
        border-left: 3px solid #dc3545;
    }
    
    .valid-feedback {
        color: #28a745;
        background: rgba(40, 167, 69, 0.1);
        border-left: 3px solid #28a745;
    }
    
    .form-group {
        position: relative;
        margin-bottom: 1.5rem;
    }
    
    .form-group label {
        font-weight: 600;
        margin-bottom: 8px;
        color: #0d47a1;
        display: flex;
        align-items: center;
    }
    
    .form-group label i {
        margin-right: 8px;
        font-size: 0.9rem;
    }
    
    .input-with-icon {
        position: relative;
    }
    
    .input-with-icon i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        z-index: 5;
    }
    
    .input-with-icon input,
    .input-with-icon select {
        padding-left: 40px;
    }
    
    .input-with-icon .select2-selection__rendered {
        padding-left: 30px !important;
    }
    
    .section-divider {
        height: 1px;
        background: linear-gradient(to right, transparent, #BBDEFB, transparent);
        margin: 25px 0;
    }
</style>

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <!-- Staff Profile Header -->
                <div class="staff-profile-header pat-prem-animated">
                    <img src="{% if staff.profile_picture %}{{ staff.profile_picture.url }}{% else %}{% static 'dist/img/user2-160x160.jpg' %}{% endif %}" 
                         class="staff-avatar" alt="Staff Avatar">
                    <div class="staff-info">
                        <div class="staff-name">{{ staff.admin.first_name }} {{ staff.middle_name }} {{ staff.admin.last_name }}</div>
                        <div class="staff-details">
                            <div class="staff-detail-item">
                                <i class="fas fa-id-badge"></i> ID: {{ staff.id }}
                            </div>
                            <div class="staff-detail-item">
                                <i class="fas fa-user-tag"></i> Role: {{ staff.get_role_display }}
                            </div>
                            <div class="staff-detail-item">
                                <i class="fas fa-briefcase"></i> Profession: {{ staff.get_profession_display }}
                            </div>
                            <div class="staff-detail-item">
                                <i class="fas fa-map-marker-alt"></i> Work Place: {{ staff.get_work_place_display }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- General form elements -->
                <div class="card pat-prem-form-card shadow-lg pat-prem-animated">
                    <div class="card-header">
                        <h5 class="card-title mb-0"><i class="fas fa-user-edit mr-2"></i>Edit Staff Information</h5>
                    </div>
                    <div class="card-body">
                        <form id="editStaffForm" action="{% url 'resa_admin_edit_staff_save' %}" method="post" novalidate>
                            {% csrf_token %}
                            <input type="hidden" name="staff_id" value="{{ staff.id }}">
                            
                            <!-- Personal Information -->
                            <div class="form-section-header">
                                <i class="fas fa-user-circle"></i> Personal Information
                            </div>
                            
                            <div class="row">
                                <div class="form-group col-md-4">
                                    <label for="firstName"><i class="fas fa-signature"></i> First Name</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-user"></i>
                                        <input type="text" class="form-control pat-prem-form-control" name="firstName" id="firstName" 
                                               value="{{ staff.admin.first_name }}" required>
                                    </div>
                                    <div class="invalid-feedback">First name is required.</div>
                                </div>
                                
                                <div class="form-group col-md-4">
                                    <label for="middleName"><i class="fas fa-signature"></i> Middle Name</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-user"></i>
                                        <input type="text" class="form-control pat-prem-form-control" name="middleName" id="middleName" 
                                               value="{{ staff.middle_name }}">
                                    </div>
                                </div>
                                
                                <div class="form-group col-md-4">
                                    <label for="lastname"><i class="fas fa-signature"></i> Last Name</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-user"></i>
                                        <input type="text" class="form-control pat-prem-form-control" name="lastname" id="lastname" 
                                               value="{{ staff.admin.last_name }}" required>
                                    </div>
                                    <div class="invalid-feedback">Last name is required.</div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-md-4">
                                    <label for="email"><i class="fas fa-envelope"></i> Email</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-at"></i>
                                        <input type="email" class="form-control pat-prem-form-control" name="email" id="email" 
                                               value="{{ staff.admin.email }}" required>
                                    </div>
                                    <div class="invalid-feedback">Email is required and should be valid.</div>
                                </div>
                                
                                <div class="form-group col-md-4">
                                    <label for="username"><i class="fas fa-user"></i> Username</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-user-circle"></i>
                                        <input type="text" class="form-control pat-prem-form-control" name="username" id="username" 
                                               value="{{ staff.admin.username }}" required>
                                    </div>
                                    <div class="invalid-feedback">Username is required.</div>
                                </div>
                                
                                <div class="form-group col-md-4">
                                    <label for="phone"><i class="fas fa-phone"></i> Phone</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-mobile-alt"></i>
                                        <input type="tel" class="form-control pat-prem-form-control" id="phone" name="phone" 
                                               value="{{ staff.phone_number }}" required 
                                               pattern="0\d{9}" title="Please enter a valid 10-digit phone number starting with '0'" 
                                               onchange="validatePhone(this)" maxlength="10" minlength="10">
                                    </div>
                                    <div id="phone-error" class="invalid-feedback" style="display: none;">
                                        Please enter a valid 10-digit phone number starting with '0'
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-md-4">
                                    <label for="gender"><i class="fas fa-venus-mars"></i> Gender</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-venus-mars"></i>
                                        <select class="form-control select2bs4 pat-prem-select2" name="gender" id="gender" required>
                                            <option value="">Select Gender</option>
                                            <option value="male" {% if staff.gender == 'male' %}selected{% endif %}>Male</option>
                                            <option value="female" {% if staff.gender == 'female' %}selected{% endif %}>Female</option>
                                        </select>
                                    </div>
                                    <div class="invalid-feedback">Gender is required.</div>
                                </div>
                                
                                <div class="form-group col-md-4">
                                    <label for="dob"><i class="fas fa-birthday-cake"></i> Date of Birth</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-calendar-day"></i>
                                        <input type="date" class="form-control pat-prem-form-control" id="date_of_birth" name="date_of_birth" 
                                               value="{{ staff.date_of_birth|date:'Y-m-d' }}" required>
                                    </div>
                                    <div class="invalid-feedback">Date of birth is required.</div>
                                </div>
                                
                                <div class="form-group col-md-4">
                                    <label for="maritalStatus"><i class="fas fa-heart"></i> Marital Status</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-ring"></i>
                                        <select class="form-control select2bs4 pat-prem-select2" name="maritalStatus" id="maritalStatus" required>
                                            <option value="">Select Marital Status</option>
                                            <option value="single" {% if staff.marital_status == 'single' %}selected{% endif %}>Single</option>
                                            <option value="married" {% if staff.marital_status == 'married' %}selected{% endif %}>Married</option>
                                            <option value="divorced" {% if staff.marital_status == 'divorced' %}selected{% endif %}>Divorced</option>
                                            <option value="widowed" {% if staff.marital_status == 'widowed' %}selected{% endif %}>Widowed</option>
                                        </select>
                                    </div>
                                    <div class="invalid-feedback">Marital status is required.</div>
                                </div>
                            </div>

                            <div class="section-divider"></div>
                            
                            <!-- Professional Information -->
                            <div class="form-section-header">
                                <i class="fas fa-briefcase"></i> Professional Information
                            </div>
                            
                            <div class="row">
                                <div class="form-group col-md-4">
                                    <label for="profession"><i class="fas fa-user-md"></i> Profession</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-user-tie"></i>
                                        <select class="form-control select2bs4 pat-prem-select2" name="profession" id="profession" required>
                                            <option value="">Select Profession</option>
                                            <option value="doctor" {% if staff.profession == 'doctor' %}selected{% endif %}>Doctor</option>
                                            <option value="specialist" {% if staff.profession == 'specialist' %}selected{% endif %}>Specialist</option>
                                            <option value="nurse" {% if staff.profession == 'nurse' %}selected{% endif %}>Nurse</option>
                                            <option value="pharmacist" {% if staff.profession == 'pharmacist' %}selected{% endif %}>Pharmacist</option>
                                            <option value="developer" {% if staff.profession == 'developer' %}selected{% endif %}>Developer</option>
                                            <option value="designer" {% if staff.profession == 'designer' %}selected{% endif %}>Designer</option>
                                            <option value="manager" {% if staff.profession == 'manager' %}selected{% endif %}>Manager</option>
                                            <option value="radiologist" {% if staff.profession == 'radiologist' %}selected{% endif %}>Radiologist</option>
                                            <option value="lab_technician" {% if staff.profession == 'lab_technician' %}selected{% endif %}>Lab Technician</option>
                                            <option value="receptionist" {% if staff.profession == 'receptionist' %}selected{% endif %}>Receptionist</option>
                                            <option value="physiotherapist" {% if staff.profession == 'physiotherapist' %}selected{% endif %}>Physiotherapist</option>
                                            <option value="accountant" {% if staff.profession == 'accountant' %}selected{% endif %}>Accountant</option>
                                            <option value="security_guard" {% if staff.profession == 'security_guard' %}selected{% endif %}>Security Guard</option>
                                            <option value="chef" {% if staff.profession == 'chef' %}selected{% endif %}>Chef</option>
                                            <option value="cleaner" {% if staff.profession == 'cleaner' %}selected{% endif %}>Cleaner</option>
                                        </select>
                                    </div>
                                    <div class="invalid-feedback">Profession is required.</div>
                                </div>
                                
                                <div class="form-group col-md-4">
                                    <label for="userRole"><i class="fas fa-user-shield"></i> Role</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-user-cog"></i>
                                        <select class="form-control select2bs4 pat-prem-select2" name="userRole" id="userRole" required>
                                            <option value="">Select Role</option>
                                            <option value="admin" {% if staff.role == 'admin' %}selected{% endif %}>Administrator</option>
                                            <option value="doctor" {% if staff.role == 'doctor' %}selected{% endif %}>Doctor</option>
                                            <option value="nurse" {% if staff.role == 'nurse' %}selected{% endif %}>Nurse</option>
                                            <option value="physiotherapist" {% if staff.role == 'physiotherapist' %}selected{% endif %}>Physiotherapist</option>
                                            <option value="labTechnician" {% if staff.role == 'labTechnician' %}selected{% endif %}>Lab Technician</option>
                                            <option value="pharmacist" {% if staff.role == 'pharmacist' %}selected{% endif %}>Pharmacist</option>
                                            <option value="receptionist" {% if staff.role == 'receptionist' %}selected{% endif %}>Receptionist</option>
                                        </select>
                                    </div>
                                    <div class="invalid-feedback">Role is required.</div>
                                </div>
                                
                                <div class="form-group col-md-4">
                                    <label for="mct_number"><i class="fas fa-id-card-alt"></i> MCT Number</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-address-card"></i>
                                        <input type="text" class="form-control pat-prem-form-control" name="mct_number" id="mct_number" 
                                               value="{{ staff.mct_number }}" required>
                                    </div>
                                    <div class="invalid-feedback">MCT Number is required.</div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-md-4">
                                    <label for="Workingplace"><i class="fas fa-building"></i> Working Place</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-hospital"></i>
                                        <select class="form-control select2bs4 pat-prem-select2" name="Workingplace" id="Workingplace" required>
                                            <option value="">Select Working place</option>
                                            <option value="resa" {% if staff.work_place == 'resa' %}selected{% endif %}>Resa</option>
                                            <option value="kahama" {% if staff.work_place == 'kahama' %}selected{% endif %}>Kahama</option>
                                            <option value="pemba" {% if staff.work_place == 'pemba' %}selected{% endif %}>Pemba</option>
                                        </select>
                                    </div>
                                    <div class="invalid-feedback">Working place is required.</div>
                                </div>
                                
                                <div class="form-group col-md-4">
                                    <label for="joiningDate"><i class="fas fa-calendar-alt"></i> Joining Date</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-calendar-check"></i>
                                        <input type="date" class="form-control pat-prem-form-control" name="joiningDate" id="joiningDate" 
                                               value="{{ staff.joining_date|date:'Y-m-d' }}" required>
                                    </div>
                                    <div class="invalid-feedback">Joining date is required.</div>
                                </div>
                            </div>

                            <div class="section-divider"></div>
                            
                            <!-- Form Actions -->
                            <div class="form-group row">
                                <div class="col-md-12 text-right">
                                    <button type="reset" class="btn pat-prem-btn-action mr-2">
                                        <i class="fas fa-undo mr-1"></i> Reset
                                    </button>
                                    <button type="submit" class="btn pat-prem-btn-success">
                                        <i class="fas fa-save mr-1"></i> Save Changes
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Messages -->
                    <div class="card-footer">
                        {% if messages %}
                            <div class="col-12">
                                {% for message in messages %}
                                    {% if message.tags == 'error' %}
                                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                            <i class="fas fa-exclamation-circle mr-2"></i> {{ message }}
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                    {% elif message.tags == 'success' %}
                                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                                            <i class="fas fa-check-circle mr-2"></i> {{ message }}
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    (function() {
      'use strict';
      window.addEventListener('load', function() {
        var form = document.getElementById('editStaffForm');
        form.addEventListener('submit', function(event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      }, false);
    })();
    
    // Phone validation function
    function validatePhone(input) {
        const phoneError = document.getElementById('phone-error');
        const phonePattern = /^0\d{9}$/;
        
        if (!phonePattern.test(input.value)) {
            phoneError.style.display = 'block';
            input.setCustomValidity('Please enter a valid 10-digit phone number starting with \'0\'');
        } else {
            phoneError.style.display = 'none';
            input.setCustomValidity('');
        }
    }
    
    // Initialize Select2
    $(document).ready(function() {
        $('.select2bs4').select2({
            theme: 'bootstrap4',
            width: '100%'
        });
        
        // Check if email and username are available
        function checkAvailability(fieldId, url, paramName, messageClass) {
            $(fieldId).on("input", function () {
                var value = $(this).val().trim();

                if (value === "") {
                    $("." + messageClass).remove();
                    return;
                }

                $.ajax({
                    url: url,
                    type: "POST",
                    data: { [paramName]: value },
                    headers: { "X-CSRFToken": "{{ csrf_token }}" },
                })
                .done(function (response) {
                    console.log(response);
                    $("." + messageClass).remove();
                    
                    if (response === "True") {
                        var message = `<span class='${messageClass}' style='padding: 5px; color: red; font-weight: bold;'>Available</span>`;
                        $(message).insertAfter(fieldId);
                    }
                })
                .fail(function () {
                    console.log("Failed");
                });
            });
        }

        // Check if email and username are available
        checkAvailability("#email", "{% url 'clinic:check_email_exist' %}", "email", "email_error");
        checkAvailability("#username", "{% url 'clinic:check_username_exist' %}", "username", "username_error");

        // Username should not be an email address validation
        $("#username").on("input", function () {
            var username = $(this).val().trim();
            $(".username_email_error").remove();

            if (username.includes("@")) {
                var message = `<span class='username_email_error' style='color: red; font-weight: bold;'>Username should not be an email address.</span>`;
                $(message).insertAfter("#username");
            }
        });

        // Date of Birth Validation (Age above 18)
        $("#date_of_birth").on("input", function () {
            var dob = new Date($(this).val());
            var today = new Date();
            var age = today.getFullYear() - dob.getFullYear();
            var monthDifference = today.getMonth() - dob.getMonth();
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < dob.getDate())) {
                age--;
            }

            $(".dob_error").remove();
            if (age < 18) {
                var message = `<span class='dob_error' style='color: red; font-weight: bold;'>Any staff must be at least 18 years old.</span>`;
                $(message).insertAfter("#date_of_birth");
            }
        });

        // Joining Date Validation (Cannot be in the future)
        $("#joiningDate").on("input", function () {
            var joiningDate = new Date($(this).val());
            var today = new Date();

            $(".joining_date_error").remove();
            if (joiningDate > today) {
                var message = `<span class='joining_date_error' style='color: red; font-weight: bold;'>Joining date cannot be in the future.</span>`;
                $(message).insertAfter("#joiningDate");
            }
        });

        // MCT Number Unique Validation (if provided)
        $("#mct_number").on("input", function () {
            var mctNumber = $(this).val().trim();

            if (mctNumber === "") {
                return;
            }

            $.ajax({
                url: "{% url 'clinic:check_mct_number_exist' %}",
                type: "POST",
                data: { "mct_number": mctNumber },
                headers: { "X-CSRFToken": "{{ csrf_token }}" },
            })
            .done(function (response) {
                $(".mct_number_error").remove();
                
                if (response === "True") {
                    var message = `<span class='mct_number_error' style='color: red; font-weight: bold;'>MCT number already exists. Please provide a unique MCT number.</span>`;
                    $(message).insertAfter("#mct_number");
                }
            })
            .fail(function () {
                console.log("Failed to check MCT number.");
            });
        });
    });
</script>

{% endblock main_content %}