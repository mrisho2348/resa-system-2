{% load static %}
<aside class="main-sidebar sidebar-dark-primary elevation-4">
  <!-- Brand Logo -->
  <a href="#" class="brand-link">
    <img src="{% static 'img/resalogo_square.png' %}" 
    alt="RESA LOGO" 
    class="ml-2 img-circle shadow-lg"
    style="
      width: 50px; 
      height: 50px; 
      object-fit: cover; 
      border-radius: 50%; 
      border: 4px solid #ffffff;
      background-color: #ffffff;
    ">
    <span class="ml-2 brand-text font-weight-light">Resa Clinic</span>
</a>

<style>
    .img-circle {
        border-radius: 0%; /* Ensures a circular image */
        width: 90px;       /* Adjust the size as needed */
        height: 90px;      /* Ensure a perfect circle */
    }
    .brand-link {
        display: flex;        /* Aligns image and text horizontally */
        align-items: center;  /* Centers image and text vertically */
        text-decoration: none; /* Removes underline */
        color: inherit;       /* Keeps default text color */
    }
    .brand-image {
        margin-right: 10px;  /* Space between image and text */
        opacity: 0.8;        /* Adjust image transparency */
    }
    .brand-text {
        font-weight: lighter; /* Customizes font weight */
        font-size: 1.2rem;    /* Adjust font size */
    }
    .user-panel .image img {
        width: 50px; /* Adjust size as needed */
        height: 50px; /* Make sure width and height are equal */
        object-fit: cover; /* Ensures the image fits well */
        border-radius: 50%; /* Makes the image circular */
        border: 2px solid white; /* Optional border */
    }
    
</style>

  <!-- Sidebar -->
  <div class="sidebar"> 
    <div class="user-panel mt-3 pb-3 mb-3 d-flex">   
        {% if user.staff.id %}
            <div class="image">
                {% if user.staff.profile_picture %}
                    <img src="{{ user.staff.profile_picture.url }}" class="img-circle elevation-2" alt="User Image">
                {% else %}
                    <img src="{% static 'dist/img/user2-160x160.jpg' %}" class="img-circle elevation-2" alt="User Image">
                {% endif %}
            </div>
            <div class="info">
                {% url 'divine_edit_staff_profile' user.staff.id as edit_staff_profile %}
                <a href="{{ edit_staff_profile }}" class="d-block">{{ user.username }}</a>                 
            </div>      
        {% else %}
            <!-- If the user does not have a staff ID -->
            <div class="image">           
                <img src="{% static 'dist/img/user2-160x160.jpg' %}" class="img-circle elevation-2" alt="User Image">          
            </div>
            <div class="info">
                <span class="d-block text-white font-weight-bold">{{ user.username }}</span>            
            </div>      
        {% endif %}
    </div>

      <!-- Sidebar Menu -->
      <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
              <!-- Home Section -->
              <li class="nav-item">
                  {% url 'divine_dashboard' as dashboard_url %}
                  <a href="{{ dashboard_url }}" class="nav-link {% if request.path == dashboard_url %} active {% endif %}">
                      <i class="nav-icon fas fa-th"></i>
                      <p>HOME</p>
                  </a>
              </li> 

            <!-- Clinic Section -->
              <li class="nav-item has-treeview">
                <a href="#" class="nav-link">
                  <i class="nav-icon fas fa-hospital"></i>
                  <p>Clinic <i class="fas fa-angle-left right"></i></p>
                </a>
                <ul class="nav nav-treeview">

                  <!-- Patient Management -->
                  <li class="nav-header text-muted font-weight-bold pl-3">Patient Management</li>

                  <li class="nav-item">
                    {% url 'divine_patient_list' as patients_list_url %}
                    <a href="{{ patients_list_url }}" class="nav-link{% if request.path == patients_list_url %} active {% endif %}">
                      <i class="fas fa-users nav-icon"></i>
                      <p>Patients</p>
                    </a>
                  </li>                
                  <li class="nav-item">
                    {% url 'divine_appointment_list' as appointment_list_url %}
                    <a href="{{ appointment_list_url }}" class="nav-link{% if request.path == appointment_list_url %} active {% endif %}">
                      <i class="fas fa-calendar nav-icon"></i>
                      <p>Appointments</p>
                    </a>
                  </li>

                  <!-- Medical Services -->
                  <li class="nav-header text-muted font-weight-bold pl-3">Medical Services</li>

                  <li class="nav-item">
                    {% url 'divine_prescription_list' as prescription_list_url %}
                    <a href="{{ prescription_list_url }}" class="nav-link{% if request.path == prescription_list_url %} active {% endif %}">
                      <i class="fas fa-prescription-bottle nav-icon"></i>
                      <p>Prescriptions</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_patient_laboratory_view' as patient_laboratory_view_url %}
                    <a href="{{ patient_laboratory_view_url }}" class="nav-link{% if request.path == patient_laboratory_view_url %} active {% endif %}">
                      <i class="fas fa-flask nav-icon"></i>
                      <p>Lab Investigation</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_patient_procedure_view' as patient_procedure_view_url %}
                    <a href="{{ patient_procedure_view_url }}" class="nav-link{% if request.path == patient_procedure_view_url %} active {% endif %}">
                      <i class="fas fa-syringe nav-icon"></i>
                      <p>Medical Procedures</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_counseling_list' as counseling_list_url %}
                    <a href="{{ counseling_list_url }}" class="nav-link{% if request.path == counseling_list_url %} active {% endif %}">
                      <i class="fas fa-user-friends nav-icon"></i>
                      <p>Counseling</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_consultation_notes' as consultation_notes_url %}
                    <a href="{{ consultation_notes_url }}" class="nav-link{% if request.path == consultation_notes_url %} active {% endif %}">
                      <i class="fas fa-notes-medical nav-icon"></i>
                      <p>Consultation</p>
                    </a>
                  </li>
                    <li class="nav-item">
                        {% url 'divine_patient_imaging_view' as patient_imaging_view_url %}
                        <a href="{{ patient_imaging_view_url }}" class="nav-link{% if request.path == patient_imaging_view_url %} active {% endif %}">
                            <i class="nav-icon fas fa-flask"></i> <!-- Replace 'fa-flask' with the appropriate Font Awesome icon class for laboratory -->
                            <p>Imaging/Radiology</p> 
                        </a>
                    </li>  
                  <!-- Clinical Operations -->
                  <li class="nav-header text-muted font-weight-bold pl-3">Clinical Operations</li>

                  <li class="nav-item">
                    {% url 'divine_observation_record_list' as observation_record_list_url %}
                    <a href="{{ observation_record_list_url }}" class="nav-link{% if request.path == observation_record_list_url %} active {% endif %}">
                      <i class="fas fa-stethoscope nav-icon"></i>
                      <p>Observation Records</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_discharge_notes_list' as discharge_notes_list_url %}
                    <a href="{{ discharge_notes_list_url }}" class="nav-link{% if request.path == discharge_notes_list_url %} active {% endif %}">
                      <i class="fas fa-file-medical nav-icon"></i>
                      <p>Discharge Notes</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_manage_referral' as manage_referral_url %}
                    <a href="{{ manage_referral_url }}" class="nav-link{% if request.path == manage_referral_url %} active {% endif %}">
                      <i class="fas fa-handshake nav-icon"></i>
                      <p>Referral</p>
                    </a>
                  </li>

                  <!-- Reporting -->
                  <li class="nav-header text-muted font-weight-bold pl-3">Reporting</li>

                  <li class="nav-item">
                    {% url 'divine_generate_year_month_report' as generate_year_month_report_url %}
                    <a href="{{ generate_year_month_report_url }}" class="nav-link{% if request.path == generate_year_month_report_url %} active {% endif %}">
                      <i class="fas fa-chart-line nav-icon"></i>
                      <p>Comprehensive Reports</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_resa_report' as resa_report_url %}
                    <a href="{{ resa_report_url }}" class="nav-link{% if request.path == resa_report_url %} active {% endif %}">
                      <i class="fas fa-file-alt nav-icon"></i>
                      <p>Resa Reports</p>
                    </a>
                  </li>
                </ul>
              </li>
              <!-- Settings Section -->
              <li class="nav-header">Settings</li>

              <!-- Clinic Setup -->
              <li class="nav-item has-treeview">
                <a href="#" class="nav-link">
                  <i class="nav-icon fas fa-tools"></i>
                  <p>Clinic Setup<i class="fas fa-angle-left right"></i></p>
                </a>
                <ul class="nav nav-treeview">
                  <li class="nav-item">
                    {% url 'divine_add_clinic_company' as company_registration_view_url %}
                    <a href="{{ company_registration_view_url }}" class="nav-link{% if request.path == company_registration_view_url %} active {% endif %}">
                      <i class="fas fa-clipboard-list nav-icon"></i>
                      <p>Clinic Register</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_manage_staff' as manage_staff_url %}
                    <a href="{{ manage_staff_url }}" class="nav-link{% if request.path == manage_staff_url %} active {% endif %}">
                      <i class="fas fa-users nav-icon"></i>
                      <p>Staffs</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_manage_company' as manage_company_url %}
                    <a href="{{ manage_company_url }}" class="nav-link{% if request.path == manage_company_url %} active {% endif %}">
                      <i class="fas fa-building nav-icon"></i>
                      <p>Patient Companies</p>
                    </a>
                  </li>
                </ul>
              </li>

             <li class="nav-item has-treeview">
              <a href="#" class="nav-link">
                <i class="nav-icon fas fa-pills"></i>
                <p>
                  Medicine Management
                  <i class="fas fa-angle-left right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  {% url 'divine_remotemedicine_list' as remotemedicine_list_url %}
                  <a href="{{ remotemedicine_list_url }}" class="nav-link{% if request.path == remotemedicine_list_url %} active {% endif %}">
                    <i class="fas fa-tablets nav-icon"></i>
                    <p>All Medicines <span class="badge badge-primary right" id="badge_all">0</span></p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'divine_expired_medicine_view' %}" class="nav-link">
                    <i class="fas fa-calendar-times nav-icon"></i>
                    <p>Expired Medicine <span class="badge badge-danger right" id="badge_expired">0</span></p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'divine_instock_medicine_view' %}" class="nav-link">
                    <i class="fas fa-check-circle nav-icon"></i>
                    <p>In Stock Medicine <span class="badge badge-success right" id="badge_instock">0</span></p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'divine_checklist_medicine_view' %}" class="nav-link">
                    <i class="fas fa-list nav-icon"></i>
                    <p>Checklist Medicine <span class="badge badge-info right" id="badge_checklist">0</span></p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'divine_outofstock_medicine_view' %}" class="nav-link">
                    <i class="fas fa-exclamation-triangle nav-icon"></i>
                    <p>Out of Stock <span class="badge badge-warning right" id="badge_outofstock">0</span></p>
                  </a>
                </li>
              </ul>
            </li>

              <!-- Equipment & Reagents -->
              <li class="nav-item has-treeview">
                <a href="#" class="nav-link">
                  <i class="nav-icon fas fa-tools"></i>
                  <p>Clinic Inventory<i class="fas fa-angle-left right"></i></p>
                </a>
                <ul class="nav nav-treeview">
                  <li class="nav-item">
                    {% url 'divine_remote_equipment_list' as remote_equipment_list_url %}
                    <a href="{{ remote_equipment_list_url }}" class="nav-link{% if request.path == remote_equipment_list_url %} active {% endif %}">
                      <i class="fas fa-medkit nav-icon"></i>
                      <p>Clinic Equipment</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_reagent_list' as reagent_list_url %}
                    <a href="{{ reagent_list_url }}" class="nav-link{% if request.path == reagent_list_url %} active {% endif %}">
                      <i class="fas fa-flask nav-icon"></i>
                      <p>Clinic Reagents</p>
                    </a>
                  </li>
                </ul>
              </li>

              <!-- Diagnoses & Complaints -->
              <li class="nav-item has-treeview">
                <a href="#" class="nav-link">
                  <i class="nav-icon fas fa-notes-medical"></i>
                  <p>Medical Definitions<i class="fas fa-angle-left right"></i></p>
                </a>
                <ul class="nav nav-treeview">
                  <li class="nav-item">
                    {% url 'divine_diagnosis_list' as diagnosis_list_url %}
                    <a href="{{ diagnosis_list_url }}" class="nav-link{% if request.path == diagnosis_list_url %} active {% endif %}">
                      <i class="fas fa-stethoscope nav-icon"></i>
                      <p>View Diagnoses</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_health_record_list' as health_record_list_url %}
                    <a href="{{ health_record_list_url }}" class="nav-link{% if request.path == health_record_list_url %} active {% endif %}">
                      <i class="fas fa-heartbeat nav-icon"></i>
                      <p>Chief Complaints</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_manage_disease' as manage_disease_url %}
                    <a href="{{ manage_disease_url }}" class="nav-link{% if request.path == manage_disease_url %} active {% endif %}">
                      <i class="fas fa-biohazard nav-icon"></i>
                      <p>Diseases</p>
                    </a>
                  </li>
                </ul>
              </li>

              <!-- Other System Settings -->
              <li class="nav-item has-treeview">
                <a href="#" class="nav-link">
                  <i class="nav-icon fas fa-cog"></i>
                  <p>System Config<i class="fas fa-angle-left right"></i></p>
                </a>
                <ul class="nav nav-treeview">                 
                  <li class="nav-item">
                    {% url 'divine_manage_pathodology' as manage_pathodology_url %}
                    <a href="{{ manage_pathodology_url }}" class="nav-link{% if request.path == manage_pathodology_url %} active {% endif %}">
                      <i class="fas fa-vial nav-icon"></i>
                      <p>Pathology</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_manage_country' as manage_country_url %}
                    <a href="{{ manage_country_url }}" class="nav-link{% if request.path == manage_country_url %} active {% endif %}">
                      <i class="fas fa-globe nav-icon"></i>
                      <p>Country</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    {% url 'divine_remoteservice_list' as remoteservice_list_url %}
                    <a href="{{ remoteservice_list_url }}" class="nav-link{% if request.path == remoteservice_list_url %} active {% endif %}">
                      <i class="fas fa-hospital nav-icon"></i>
                      <p>Clinic Services</p>
                    </a>
                  </li>
                </ul>
              </li>

          </ul>
      </nav>
      <!-- /.sidebar-menu -->
  </div>
  <!-- /.sidebar -->
</aside>

<script>
  $(document).ready(function () {
    $.ajax({
      url: "{% url 'divine_medicine_count_api' %}",
      type: "GET",
      success: function (data) {
        $('#badge_all').text(data.all);
        $('#badge_expired').text(data.expired);
        $('#badge_instock').text(data.instock);
        $('#badge_checklist').text(data.checklist);
        $('#badge_outofstock').text(data.outofstock);
      },
      error: function () {
        console.error("Failed to load medicine counts.");
      }
    });
  });
</script>


<script>   

    function ReagentOutNotificationCount() {
        $.ajax({
            url: '/api/out-of-stock-reagent-count/', // Replace with your API endpoint URL
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                var count = data.count;
                // Update the notification count with the count received from the backend
                $('#notification-count-reagent').text(count);
            },
            error: function(xhr, status, error) {
                console.error('Error fetching notification count:', error);
            }
        });
    }  
    
    $(document).ready(function() {
        // Update the notification when the page loads
        updateOutOfStockNotification();
    
        ReagentOutNotificationCount();
    
        // Periodically update the notification (e.g., every 5 seconds)
        setInterval(updateOutOfStockNotification, 60000);
    });
    
</script>

